<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAMA Roleplay AI - S-P-I-N Framework Training</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc',
                            400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1',
                            800: '#075985', 900: '#0c4a6e',
                        },
                        spin: {
                            S: '#3b82f6', P: '#ef4444', I: '#f59e0b', N: '#10b981'
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'spin': 'spin 1s linear infinite'
                    },
                    keyframes: {
                        fadeIn: { from: { opacity: 0 }, to: { opacity: 1 } },
                        slideIn: { from: { transform: 'translateY(10px)', opacity: 0 }, to: { transform: 'translateY(0)', opacity: 1 } }
                    }
                }
            }
        }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .spin-gradient { background: linear-gradient(135deg, #3b82f6 0%, #ef4444 33%, #f59e0b 66%, #10b981 100%); }
        .glass-effect { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .recording-pulse { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex justify-center items-center p-4">
    <div id="root" class="w-full max-w-md bg-white shadow-2xl rounded-3xl overflow-hidden flex flex-col h-[90vh]"></div>

    <script type="text/babel">
        // ============================================
        // REACT COMPONENTS
        // ============================================
        
        const { useState, useEffect, useRef } = React;
        
        // Supabase Configuration
        const SUPABASE_CONFIG = {
            url: 'https://iuwszegqtgtvupavoucv.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1d3N6ZWdxdGd0dnVwYXZvdWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3ODE3MDIsImV4cCI6MjA4NTM1NzcwMn0.z5DmbtLgULN-DjOnM6PrD9puKmKS_vd2rD5hp0huM6g'
        };
        
        // Initialize Supabase
        let supabase;
        if (window.supabase) {
            supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
        }
        
        // RH Zone Data
        const RH_ZONES = {
            'RH1': ['จตุจักร', 'ธนบุรี', 'บางกะปิ', 'สาทร', 'สุขุมวิท'],
            'RH2': ['ชลบุรี', 'บางนา', 'พัทยา', 'ระยอง'],
            'RH3': ['เชียงใหม่', 'นครสวรรค์', 'นนทบุรี', 'พิษณุโลก', 'อยุธยา'],
            'RH4': ['ดอนเมือง', 'นครราชสีมา', 'สระบุรี', 'อุดรธานี', 'อุบลราชธานี'],
            'RH5': ['ภูเก็ต', 'ราชบุรี', 'สมุทรสาคร', 'สุราษฎร์ธานี', 'หาดใหญ่']
        };
        
        // Fallback Data
        const FALLBACK_DATA = {
            scenarios: {
                mama1: [
                    {
                        id: 'm1-01', title: 'ลูกค้าฝากเงินประจำอัตราดอกเบี้ยต่ำ',
                        situation: 'ลูกค้าวัย 60 ปี มาสาขาเพื่อฝากเงินประจำ 500,000 บาท อัตราดอกเบี้ย 0.5% ต่อปี',
                        problem: 'ดอกเบี้ยต่ำกว่าอัตราเงินเฟ้อ ทำให้มูลค่าจริงของเงินลดลง',
                        impact: 'เงิน 500,000 บาท ใน 1 ปี จะเหลือมูลค่าจริงเพียง 492,500 บาท (คิดจากอัตราเงินเฟ้อ 2%)',
                        need_payoff: 'แนะนำบัญชีเงินฝากที่ให้ดอกเบี้ยสูงขึ้นหรือกองทุนตลาดเงินเพื่อรักษามูลค่าของเงิน',
                        customer_profile: { name: 'คุณสมหมาย', age: '60', occupation: 'เกษียณราชการ', income: 'บำนาญ 20,000 บาท/เดือน' },
                        financial_products: ['เงินฝากประจำ', 'บัญชีออมทรัพย์'],
                        objectives: ['สร้างความสัมพันธ์กับลูกค้า', 'อธิบายผลกระทบของดอกเบี้ยต่ำ', 'แนะนำทางเลือกที่เหมาะสม'],
                        time_limit: '4 นาที'
                    },
                    {
                        id: 'm1-02', title: 'ลูกค้าใช้บริการโอนเงินผ่านสาขาบ่อย',
                        situation: 'ลูกค้าวัย 35 ปี มาโอนเงินผ่านสาขา สัปดาห์ละ 2-3 ครั้ง ครั้งละ 5,000-10,000 บาท',
                        problem: 'เสียเวลาเดินทางและเสี่ยงต่อการสูญเสียเงินระหว่างทาง',
                        impact: 'เสียเวลาเฉลี่ย 2 ชม./สัปดาห์ คิดเป็นมูลค่า 500 บาท/สัปดาห์ และเสี่ยงต่อการถูกโจรกรรม',
                        need_payoff: 'แนะนำบริการธนาคารออนไลน์และ Mobile Banking',
                        customer_profile: { name: 'คุณวิไล', age: '35', occupation: 'เจ้าของร้านค้า', income: '50,000 บาท/เดือน' },
                        financial_products: ['บัญชีออมทรัพย์', 'บัตร ATM'],
                        objectives: ['สอบถามความถี่ในการใช้บริการ', 'คำนวณเวลาและความเสี่ยงที่เสียไป', 'สาธิตการใช้งาน Mobile Banking'],
                        time_limit: '3 นาที'
                    },
                    {
                        id: 'm1-03', title: 'ลูกค้าจ่ายบิลผ่านเคาน์เตอร์ทุกเดือน',
                        situation: 'ลูกค้าวัย 45 ปี มาจ่ายบิลค่าสาธารณูปโภคผ่านเคาน์เตอร์ทุกสิ้นเดือน',
                        problem: 'เสียเวลารอคิวและจ่ายค่าธรรมเนียมเพิ่ม',
                        impact: 'เสียเวลาเฉลี่ย 30 นาที/ครั้ง และจ่ายค่าธรรมเนียม 10-20 บาท/ใบ',
                        need_payoff: 'แนะนำบริการจ่ายบิลอัตโนมัติ (Auto Debit)',
                        customer_profile: { name: 'คุณประเสริฐ', age: '45', occupation: 'พนักงานโรงงาน', income: '35,000 บาท/เดือน' },
                        financial_products: ['บัญชีออมทรัพย์', 'บัตรเดบิต'],
                        objectives: ['สอบถามประเภทและจำนวนบิล', 'คำนวณค่าใช้จ่ายและเวลาที่เสียไป', 'เสนอบริการ Auto Debit'],
                        time_limit: '4 นาที'
                    },
                    {
                        id: 'm1-04', title: 'ลูกค้ามีเงินสดจำนวนมากเก็บที่บ้าน',
                        situation: 'ลูกค้าวัย 55 ปี เจ้าของร้านขายของชำ นำเงินสด 300,000 บาท มาฝากที่ธนาคาร',
                        problem: 'เสี่ยงต่อการถูกโจรกรรมและเงินเสียหาย',
                        impact: 'เสี่ยงสูญเสียเงินทั้งหมดหากถูกโจรกรรม และเสี่ยงต่อการจัดเก็บที่ไม่ปลอดภัย',
                        need_payoff: 'แนะนำบริการเก็บรักษาความปลอดภัยและผลิตภัณฑ์เงินฝาก',
                        customer_profile: { name: 'คุณสำราญ', age: '55', occupation: 'เจ้าของร้านค้า', income: '80,000 บาท/เดือน' },
                        financial_products: ['เงินสด'],
                        objectives: ['สร้างความไว้วางใจ', 'อธิบายความเสี่ยงของการเก็บเงินสด', 'แนะนำบริการตู้เซฟและเงินฝาก'],
                        time_limit: '5 นาที'
                    },
                    {
                        id: 'm1-05', title: 'ลูกค้าใช้บัตรเครดิตจ่ายขั้นต่ำ',
                        situation: 'ลูกค้าวัย 30 ปี มียอดบัตรเครดิต 50,000 บาท จ่ายขั้นต่ำทุกเดือน',
                        problem: 'เสียดอกเบี้ยสูงและเป็นหนี้ไม่รู้จบ',
                        impact: 'ดอกเบี้ย 18% ต่อปี ทำให้จ่ายดอกเบี้ย 9,000 บาท/ปี หากจ่ายเฉพาะขั้นต่ำ',
                        need_payoff: 'แนะนำผลิตภัณฑ์ปรับโครงสร้างหนี้หรือกองทุนสำรองเผื่อฉุกเฉิน',
                        customer_profile: { name: 'คุณศิริพร', age: '30', occupation: 'พนักงานออฟฟิศ', income: '40,000 บาท/เดือน' },
                        financial_products: ['บัตรเครดิต', 'บัญชีออมทรัพย์'],
                        objectives: ['สอบถามพฤติกรรมการใช้บัตร', 'คำนวณดอกเบี้ยที่ต้องจ่าย', 'เสนอทางออกทางการเงิน'],
                        time_limit: '5 นาที'
                    }
                ],
                mama2: [
                    {
                        id: 'm2-01', title: 'ลูกค้ามีพอร์ตการลงทุนกระจุกตัว',
                        situation: 'ลูกค้าวัย 45 ปี มีพอร์ตการลงทุน 5 ล้านบาท ลงทุนในหุ้นไทยเพียงอย่างเดียว 70%',
                        problem: 'ความเสี่ยงสูงจากการกระจุกตัวในสินทรัพย์ประเภทเดียว',
                        impact: 'หากตลาดหุ้นไทยปรับตัวลดลง 20% ลูกค้าจะสูญเสีย 700,000 บาท และฟื้นตัวช้า',
                        need_payoff: 'แนะนำการกระจายพอร์ตการลงทุนระหว่างประเทศและสินทรัพย์อื่นๆ',
                        customer_profile: { name: 'คุณกอบเกียรติ', age: '45', occupation: 'นักธุรกิจ', income: '300,000 บาท/เดือน' },
                        financial_products: ['หุ้นไทย 3.5M', 'เงินฝาก 1M', 'กองทุนหุ้นไทย 0.5M'],
                        objectives: ['วิเคราะห์ความเสี่ยงจากความกระจุกตัว', 'คำนวณผลกระทบจากตลาดขาลง', 'เสนอแผนการกระจายพอร์ต'],
                        time_limit: '8 นาที'
                    },
                    {
                        id: 'm2-02', title: 'ลูกค้าใกล้เกษียณแต่ยังลงทุนความเสี่ยงสูง',
                        situation: 'ลูกค้าวัย 58 ปี เกษียณใน 2 ปี พอร์ตการลงทุน 8 ล้านบาท ลงทุนในหุ้น 80%',
                        problem: 'เสี่ยงต่อการขาดทุนใกล้เกษียณ (Sequence of Returns Risk)',
                        impact: 'หากตลาดขาลงในช่วงเกษียณ อาจสูญเสีย 30-40% ของพอร์ต และส่งผลต่อแผนการใช้จ่าย',
                        need_payoff: 'แนะนำการปรับพอร์ตลดความเสี่ยงและสร้างรายได้สม่ำเสมอ',
                        customer_profile: { name: 'คุณวิเชียร', age: '58', occupation: 'ผู้บริหาร', income: '200,000 บาท/เดือน' },
                        financial_products: ['หุ้น 6.4M', 'กองทุนผสม 1M', 'เงินฝาก 0.6M'],
                        objectives: ['วิเคราะห์ความเสี่ยง Sequence of Returns', 'ประมาณการผลกระทบต่อแผนเกษียณ', 'เสนอแผนปรับพอร์ตและสร้างรายได้'],
                        time_limit: '8 นาที'
                    },
                    {
                        id: 'm2-03', title: 'ลูกค้ามีหนี้สินกับรายได้ไม่สมดุล',
                        situation: 'ลูกค้าวัย 38 ปี มีหนี้สิน 4 ล้านบาท (บ้าน+รถ) รายได้ 100,000 บาท/เดือน',
                        problem: 'ภาระหนี้สูง 40% ของรายได้ ทำให้สภาพคล่องทางการเงินต่ำ',
                        impact: 'เสี่ยงต่อการผิดนัดชำระหนี้หากรายได้ลดลง และความเครียดทางการเงินสูง',
                        need_payoff: 'แนะนำแผนการบริหารหนี้และการสร้างสภาพคล่อง',
                        customer_profile: { name: 'คุณอรุณ', age: '38', occupation: 'ทันตแพทย์', income: '100,000 บาท/เดือน' },
                        financial_products: ['สินเชื่อบ้าน 3M', 'สินเชื่อรถ 1M', 'บัตรเครดิต 200K'],
                        objectives: ['วิเคราะห์อัตราส่วนหนี้ต่อรายได้', 'ประเมินความเสี่ยงสภาพคล่อง', 'เสนอแผนการบริหารหนี้'],
                        time_limit: '7 นาที'
                    },
                    {
                        id: 'm2-04', title: 'ลูกค้าลงทุนตามกระแสโดยขาดแผน',
                        situation: 'ลูกค้าวัย 42 ปี ลงทุนตามข่าวและกระแส ขาดแผนการลงทุนที่ชัดเจน',
                        problem: 'ขาดความสม่ำเสมอและอาจขาดทุนจากการลงทุนตามอารมณ์',
                        impact: 'ผลตอบแทนไม่แน่นอนและเสี่ยงต่อการตัดสินใจผิดพลาดจากการลงทุนตามกระแส',
                        need_payoff: 'แนะนำการจัดทำแผนการลงทุนแบบมีวินัย (Disciplined Investing)',
                        customer_profile: { name: 'คุณสุนิสา', age: '42', occupation: 'แพทย์', income: '250,000 บาท/เดือน' },
                        financial_products: ['หุ้นเดี่ยว 2M', 'คริปโต 1M', 'กองทุนตามกระแส 1M'],
                        objectives: ['วิเคราะห์พฤติกรรมการลงทุน', 'ประเมินผลกระทบจากอารมณ์การลงทุน', 'เสนอแผนการลงทุนแบบมีวินัย'],
                        time_limit: '7 นาที'
                    },
                    {
                        id: 'm2-05', title: 'ลูกค้าลงทุนระยะสั้นในสินทรัพย์ระยะยาว',
                        situation: 'ลูกค้าวัย 35 ปี ใช้เงินลงทุนในหุ้นระยะยาว (5-10 ปี) สำหรับเป้าหมายระยะสั้น (1-2 ปี)',
                        problem: 'เสี่ยงต่อการขาดทุนหากต้องขายในช่วงตลาดขาลง',
                        impact: 'อาจต้องขายขาดทุน 20-30% เพื่อใช้เงินตามเป้าหมายระยะสั้น',
                        need_payoff: 'แนะนำการจับคู่สินทรัพย์กับระยะเวลาเป้าหมาย',
                        customer_profile: { name: 'คุณธีรภัทร', age: '35', occupation: 'ทนายความ', income: '150,000 บาท/เดือน' },
                        financial_products: ['หุ้นระยะยาว 3M', 'เงินฝาก 500K'],
                        objectives: ['วิเคราะห์ความไม่สอดคล้องของระยะเวลา', 'ประเมินความเสี่ยงจากการขายขาดทุน', 'เสนอการจัดสรรสินทรัพย์ตามเวลาเป้าหมาย'],
                        time_limit: '7 นาที'
                    }
                ]
            },
            objections: [
                "ไม่กล้าเปลี่ยน เดี๋ยวเงินหาย",
                "เคยลงทุนแล้วขาดทุน ไม่มั่นใจ",
                "ขอดูก่อน คิดอีกที",
                "กลัวใช้งานไม่เป็น",
                "กลัวโดนแฮกบัญชี",
                "มาเซ็นเอกสารที่ธนาคารก็ไม่นาน",
                "หุ้นไทยทำผลตอบแทนดีมาตลอด",
                "ไม่คุ้นเคยกับการลงทุนต่างประเทศ",
                "ขอลองดูตลาดต่างประเทศด้วยตัวเองก่อน",
                "ตลาดกำลังดี จะขายทำไม",
                "ต้องการผลตอบแทนสูงไว้ใช้หลังเกษียณ",
                "ที่ปรึกษาคนก่อนบอกให้ถือหุ้นไว้"
            ],
            otherScenarios: [
                {
                    id: 'other-01',
                    title: 'การขายผลิตภัณฑ์ใหม่',
                    description: 'ฝึกการนำเสนอผลิตภัณฑ์ใหม่ของธนาคารให้กับลูกค้า',
                    prompt_text: 'ประเมินทักษะการขายและนำเสนอผลิตภัณฑ์ใหม่ โดยเน้นการสร้างความต้องการและการจัดการข้อโต้แย้ง'
                },
                {
                    id: 'other-02',
                    title: 'การจัดการข้อร้องเรียน',
                    description: 'ฝึกการรับมือกับลูกค้าที่ไม่พอใจบริการ',
                    prompt_text: 'ประเมินทักษะการสื่อสาร การแสดงความเข้าใจ และการแก้ปัญหาอย่างสร้างสรรค์'
                },
                {
                    id: 'other-03',
                    title: 'การให้คำปรึกษาทางการเงิน',
                    description: 'ฝึกให้คำแนะนำทางการเงินเบื้องต้น',
                    prompt_text: 'ประเมินความรู้ทางการเงินและความสามารถในการให้คำแนะนำที่เหมาะสม'
                }
            ]
        };
        
        // ============================================
        // COMPONENTS
        // ============================================
        
        const MamaLogo = ({ size = 'medium' }) => {
            const sizes = { small: 'w-8 h-8', medium: 'w-12 h-12', large: 'w-16 h-16' };
            return React.createElement('div', {
                className: `bg-gradient-to-br from-brand-700 to-brand-900 rounded-xl flex items-center justify-center ${sizes[size] || sizes.medium}`
            }, React.createElement('span', { className: 'text-white font-bold text-lg' }, 'MAMA'));
        };
        
        const Header = ({ title, user, onBack }) => {
            return React.createElement('div', { className: 'bg-white border-b px-4 py-3 flex items-center justify-between' },
                React.createElement('div', { className: 'flex items-center gap-3' },
                    onBack && React.createElement('button', { 
                        onClick: onBack,
                        className: 'p-1 rounded-lg hover:bg-gray-100'
                    }, React.createElement(lucide.icons.ArrowLeft, { size: 20, className: 'text-gray-600' })),
                    React.createElement(MamaLogo, { size: 'small' }),
                    React.createElement('h1', { className: 'font-bold text-brand-900 text-lg' }, title)
                ),
                user && React.createElement('div', { className: 'text-right' },
                    React.createElement('p', { className: 'font-medium text-sm' }, user.firstName),
                    React.createElement('p', { className: 'text-xs text-gray-500' }, `${user.rh || ''} ${user.zone || ''}`)
                )
            );
        };
        
        const SpinBadge = ({ type, score, max = 25 }) => {
            const colors = {
                S: { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-200' },
                P: { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-200' },
                I: { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-200' },
                N: { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-200' }
            };
            
            const labels = { S: 'สถานการณ์', P: 'ปัญหา', I: 'ผลกระทบ', N: 'ทางแก้' };
            const color = colors[type] || colors.S;
            const percent = (score / max) * 100;
            
            return React.createElement('div', { className: `p-3 rounded-xl border ${color.border} ${color.bg} text-center` },
                React.createElement('div', { className: `text-2xl font-black ${color.text}` }, score),
                React.createElement('div', { className: 'text-xs font-medium text-gray-600 mt-1' }, labels[type]),
                React.createElement('div', { className: 'w-full bg-gray-200 rounded-full h-1.5 mt-2' },
                    React.createElement('div', { 
                        className: `h-1.5 rounded-full ${color.text.replace('800', '500')}`,
                        style: { width: `${percent}%` }
                    })
                )
            );
        };
        
        const PasscodeScreen = ({ onVerified }) => {
            const [passcode, setPasscode] = useState('');
            const [error, setError] = useState(false);
            const [showPasscode, setShowPasscode] = useState(false);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (passcode.toLowerCase() === 'mama') {
                    localStorage.setItem('mama_passcode', 'verified');
                    onVerified();
                } else {
                    setError(true);
                    setTimeout(() => setError(false), 1000);
                }
            };
            
            useEffect(() => {
                if (localStorage.getItem('mama_passcode') === 'verified') {
                    onVerified();
                }
            }, []);
            
            return React.createElement('div', { className: 'flex-1 flex flex-col items-center justify-center p-8 bg-gradient-to-b from-brand-50 to-white' },
                React.createElement(MamaLogo, { size: 'large' }),
                React.createElement('h1', { className: 'text-3xl font-black text-brand-900 mt-6 mb-2' }, 'MAMA Roleplay'),
                React.createElement('p', { className: 'text-gray-600 text-center mb-8' }, 'ฝึกฝนทักษะการขายด้วย S-P-I-N Framework'),
                
                React.createElement('form', { onSubmit: handleSubmit, className: 'w-full max-w-xs' },
                    React.createElement('div', { className: 'relative mb-4' },
                        React.createElement('input', {
                            type: showPasscode ? 'text' : 'password',
                            value: passcode,
                            onChange: (e) => setPasscode(e.target.value),
                            className: `w-full p-4 rounded-xl border-2 ${error ? 'border-red-500' : 'border-gray-200'} focus:border-brand-500 outline-none`,
                            placeholder: 'กรอกรหัสผ่าน',
                            autoFocus: true
                        }),
                        React.createElement('button', {
                            type: 'button',
                            onClick: () => setShowPasscode(!showPasscode),
                            className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500'
                        }, showPasscode ? React.createElement(lucide.icons.EyeOff, { size: 20 }) : React.createElement(lucide.icons.Eye, { size: 20 }))
                    ),
                    
                    error && React.createElement('p', { className: 'text-red-500 text-sm text-center mb-4 animate-pulse' }, 'รหัสผ่านไม่ถูกต้อง'),
                    
                    React.createElement('button', {
                        type: 'submit',
                        className: 'w-full bg-brand-700 text-white py-4 rounded-xl font-bold hover:bg-brand-800 active:scale-95 transition-all'
                    }, 'เข้าสู่ระบบ'),
                    
                    React.createElement('p', { className: 'text-xs text-gray-500 text-center mt-4' }, 'รหัสผ่าน: mama (ตัวใหญ่หรือเล็กก็ได้)')
                )
            );
        };
        
        // ============================================
        // MAIN APP
        // ============================================
        
        const App = () => {
            // State Management
            const [view, setView] = useState('passcode');
            const [user, setUser] = useState({
                empId: '', firstName: '', lastName: '', position: 'Staff',
                rh: '', zone: '', rhCode: '', zoneCode: ''
            });
            const [selectedRH, setSelectedRH] = useState('');
            const [zones, setZones] = useState([]);
            const [course, setCourse] = useState(null);
            const [scenarios, setScenarios] = useState({ mama1: [], mama2: [], other: [] });
            const [currentScenario, setCurrentScenario] = useState(null);
            const [loading, setLoading] = useState(false);
            const [recordingState, setRecordingState] = useState('idle'); // idle, recording, preview
            const [audioBlob, setAudioBlob] = useState(null);
            const [transcript, setTranscript] = useState('');
            const [timer, setTimer] = useState(0);
            const [currentObjection, setCurrentObjection] = useState('');
            const [result, setResult] = useState(null);
            const [showAdmin, setShowAdmin] = useState(false);
            const [adminTab, setAdminTab] = useState('scenarios');
            const [geminiKey, setGeminiKey] = useState('');
            const [otherScenarios, setOtherScenarios] = useState([]);
            
            // Refs
            const timerRef = useRef(null);
            const mediaRecorderRef = useRef(null);
            const audioChunksRef = useRef([]);
            const recognitionRef = useRef(null);
            
            // Initialize
            useEffect(() => {
                console.log('Initializing MAMA Roleplay System...');
                
                // Load saved data
                const savedUser = localStorage.getItem('mama_user');
                if (savedUser) setUser(JSON.parse(savedUser));
                
                const savedKey = localStorage.getItem('mama_gemini_key');
                if (savedKey) setGeminiKey(savedKey);
                
                // Load scenarios
                loadScenarios();
                
                // Check speech recognition support
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    console.warn('Speech Recognition not supported');
                }
            }, []);
            
            const loadScenarios = async () => {
                setLoading(true);
                
                try {
                    // Try to load from Supabase
                    if (supabase) {
                        const { data: mama1Scenarios, error: e1 } = await supabase
                            .from('scenarios')
                            .select('*')
                            .eq('course', 'mama1')
                            .eq('is_active', true);
                        
                        const { data: mama2Scenarios, error: e2 } = await supabase
                            .from('scenarios')
                            .select('*')
                            .eq('course', 'mama2')
                            .eq('is_active', true);
                        
                        const { data: otherScenarios, error: e3 } = await supabase
                            .from('other_scenarios')
                            .select('*')
                            .eq('is_active', true);
                        
                        if (!e1 && mama1Scenarios) setScenarios(prev => ({ ...prev, mama1: mama1Scenarios }));
                        if (!e2 && mama2Scenarios) setScenarios(prev => ({ ...prev, mama2: mama2Scenarios }));
                        if (!e3 && otherScenarios) setOtherScenarios(otherScenarios);
                    }
                } catch (error) {
                    console.error('Error loading from Supabase:', error);
                }
                
                // Use fallback data
                setScenarios(FALLBACK_DATA.scenarios);
                setOtherScenarios(FALLBACK_DATA.otherScenarios);
                
                setLoading(false);
            };
            
            // View Handlers
            const handlePasscodeVerified = () => {
                const savedUser = localStorage.getItem('mama_user');
                if (savedUser) {
                    const parsed = JSON.parse(savedUser);
                    if (parsed.rh && parsed.zone) {
                        setView('menu');
                    } else {
                        setView('login');
                    }
                } else {
                    setView('login');
                }
            };
            
            const handleLogin = () => {
                if (!user.empId || !user.firstName) {
                    alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                    return;
                }
                localStorage.setItem('mama_user', JSON.stringify(user));
                setView('rh_selection');
            };
            
            const handleRHSelect = (rh) => {
                setSelectedRH(rh);
                setUser(prev => ({ ...prev, rh, rhCode: rh }));
                setZones(RH_ZONES[rh] || []);
            };
            
            const handleZoneSelect = (zone) => {
                const updatedUser = { ...user, zone, zoneCode: `Z${zones.indexOf(zone) + 1}` };
                setUser(updatedUser);
                localStorage.setItem('mama_user', JSON.stringify(updatedUser));
                setView('intro');
            };
            
            const handleCourseSelect = (selectedCourse) => {
                setCourse(selectedCourse);
                setLoading(true);
                
                setTimeout(() => {
                    const courseScenarios = scenarios[selectedCourse] || [];
                    if (courseScenarios.length > 0) {
                        const randomIndex = Math.floor(Math.random() * courseScenarios.length);
                        setCurrentScenario(courseScenarios[randomIndex]);
                    }
                    setLoading(false);
                    setView('scenario');
                }, 1000);
            };
            
            const handleOtherScenarioSelect = (scenario) => {
                setCurrentScenario(scenario);
                setCourse('other');
                setView('scenario');
            };
            
            const startRoleplay = () => {
                const objections = FALLBACK_DATA.objections;
                const randomObjection = objections[Math.floor(Math.random() * objections.length)];
                setCurrentObjection(randomObjection);
                setRecordingState('idle');
                setAudioBlob(null);
                setTranscript('');
                setView('record');
            };
            
            // Recording Functions
            const startRecording = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    audioChunksRef.current = [];
                    
                    mediaRecorderRef.current.ondataavailable = (e) => {
                        if (e.data.size > 0) audioChunksRef.current.push(e.data);
                    };
                    
                    mediaRecorderRef.current.onstop = () => {
                        const blob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                        setAudioBlob(blob);
                        // Generate mock transcript
                        setTranscript('สวัสดีค่ะคุณลูกค้า ผมเห็นว่าคุณฝากเงินประจำกับเราในอัตราดอกเบี้ยที่ต่ำกว่าอัตราเงินเฟ้อ ซึ่งอาจทำให้มูลค่าจริงของเงินลดลงเรื่อยๆ เรามีผลิตภัณฑ์ทางเลือกที่ให้ผลตอบแทนดีกว่าและช่วยรักษามูลค่าของเงินได้ค่ะ');
                    };
                    
                    mediaRecorderRef.current.start();
                    setRecordingState('recording');
                    setTimer(0);
                    
                    // Start speech recognition if available
                    if ('webkitSpeechRecognition' in window) {
                        const SpeechRecognition = window.webkitSpeechRecognition;
                        recognitionRef.current = new SpeechRecognition();
                        recognitionRef.current.continuous = true;
                        recognitionRef.current.interimResults = true;
                        recognitionRef.current.lang = 'th-TH';
                        
                        recognitionRef.current.onresult = (event) => {
                            let finalTranscript = '';
                            for (let i = event.resultIndex; i < event.results.length; ++i) {
                                if (event.results[i].isFinal) {
                                    finalTranscript += event.results[i][0].transcript;
                                }
                            }
                            if (finalTranscript) {
                                setTranscript(prev => prev + ' ' + finalTranscript);
                            }
                        };
                        
                        recognitionRef.current.start();
                    }
                    
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('กรุณาอนุญาตการใช้ไมโครโฟน');
                }
            };
            
            const stopRecording = () => {
                setRecordingState('preview');
                if (mediaRecorderRef.current) {
                    mediaRecorderRef.current.stop();
                    mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());
                }
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                }
            };
            
            // Timer
            useEffect(() => {
                if (recordingState === 'recording') {
                    timerRef.current = setInterval(() => setTimer(t => t + 1), 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [recordingState]);
            
            // AI Evaluation
            const submitForEvaluation = async () => {
                setView('processing');
                
                // Prepare evaluation data
                const evaluationData = {
                    scenario: currentScenario?.title || '',
                    situation: currentScenario?.situation || '',
                    problem: currentScenario?.problem || '',
                    impact: currentScenario?.impact || '',
                    need_payoff: currentScenario?.need_payoff || '',
                    objection: currentObjection,
                    transcript: transcript || 'ไม่มีข้อความจากการบันทึกเสียง',
                    course: course
                };
                
                let aiResult = null;
                
                // Try Gemini API if key exists
                if (geminiKey && geminiKey.trim() !== '') {
                    try {
                        const prompt = `
                            คุณเป็นผู้ฝึกสอนพนักงานธนาคาร ประเมินบทสนทนาจากการ Roleplay
                            
                            สถานการณ์ (S): ${evaluationData.situation}
                            ปัญหา (P): ${evaluationData.problem}
                            ผลกระทบ (I): ${evaluationData.impact}
                            ทางแก้ (N): ${evaluationData.need_payoff}
                            ข้อโต้แย้งลูกค้า: "${evaluationData.objection}"
                            คำตอบพนักงาน: "${evaluationData.transcript}"
                            
                            ประเมินตาม S-P-I-N Framework (0-25 คะแนนต่อด้าน):
                            - S: การเปิดบทสนทนาจากสถานการณ์
                            - P: การระบุปัญหาที่ชัดเจน
                            - I: การสื่อสารผลกระทบ
                            - N: การเสนอทางแก้ไข
                            
                            ตอบเป็น JSON เท่านั้น:
                            {
                                "total": 0-100,
                                "isPassed": true/false,
                                "spin_scores": {
                                    "S": [0-25, "feedback"],
                                    "P": [0-25, "feedback"],
                                    "I": [0-25, "feedback"],
                                    "N": [0-25, "feedback"]
                                },
                                "aiAdvise": "คำแนะนำภาษาไทย",
                                "suggested_improvements": ["ข้อ1", "ข้อ2", "ข้อ3"]
                            }
                        `;
                        
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }]
                            })
                        });
                        
                        const data = await response.json();
                        const text = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                        
                        // Parse JSON response
                        const jsonMatch = text.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            aiResult = JSON.parse(jsonMatch[0]);
                        } else {
                            throw new Error('Invalid AI response');
                        }
                        
                    } catch (error) {
                        console.error('Gemini API error:', error);
                    }
                }
                
                // Fallback mock evaluation
                if (!aiResult) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const scores = {
                        S: [18 + Math.floor(Math.random() * 5), 'เปิดบทสนทนาจากสถานการณ์ได้ดี'],
                        P: [16 + Math.floor(Math.random() * 5), 'ระบุปัญหาที่อาจเกิดขึ้นได้ชัดเจน'],
                        I: [17 + Math.floor(Math.random() * 5), 'สื่อสารผลกระทบได้อย่างมีประสิทธิภาพ'],
                        N: [19 + Math.floor(Math.random() * 5), 'เสนอทางแก้ไขที่เหมาะสมกับความต้องการ']
                    };
                    
                    const total = Object.values(scores).reduce((sum, [score]) => sum + score, 0);
                    
                    aiResult = {
                        total,
                        isPassed: total >= 70,
                        spin_scores: scores,
                        aiAdvise: 'คุณใช้ S-P-I-N Framework ได้ดี เปิดบทสนทนาจากสถานการณ์ได้เป็นธรรมชาติ สามารถพัฒนาเพิ่มเติมโดยการยกตัวอย่างตัวเลขผลกระทบให้ชัดเจนยิ่งขึ้น',
                        suggested_improvements: [
                            'ฝึกใช้คำถามเปิดเพื่อสำรวจความต้องการเพิ่มเติม',
                            'ยกตัวอย่างตัวเลขผลกระทบให้เห็นภาพชัดเจน',
                            'เสนอทางเลือกมากกว่า 1 ทางแก้ไข'
                        ]
                    };
                }
                
                // Save to Supabase if available
                if (supabase && user.empId) {
                    try {
                        await supabase.from('submissions').insert({
                            user_id: user.empId,
                            user_name: user.firstName,
                            rh_code: user.rhCode,
                            zone_code: user.zoneCode,
                            course: course,
                            scenario_id: currentScenario?.id,
                            transcript: transcript,
                            score: aiResult.total,
                            feedback: aiResult.aiAdvise,
                            ai_analysis: aiResult
                        });
                    } catch (error) {
                        console.error('Error saving submission:', error);
                    }
                }
                
                setResult(aiResult);
                setView('result');
            };
            
            // Render Views
            const renderView = () => {
                switch (view) {
                    case 'passcode':
                        return React.createElement(PasscodeScreen, { onVerified: handlePasscodeVerified });
                    
                    case 'login':
                        return React.createElement('div', { className: 'flex-1 p-8 flex flex-col justify-center' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-brand-900 mb-6 text-center' }, 'ลงทะเบียนผู้ใช้'),
                            
                            React.createElement('div', { className: 'space-y-4' },
                                ['empId', 'firstName', 'lastName'].map(field => 
                                    React.createElement('div', { key: field },
                                        React.createElement('input', {
                                            type: 'text',
                                            placeholder: field === 'empId' ? 'รหัสพนักงาน' : field === 'firstName' ? 'ชื่อ' : 'นามสกุล',
                                            value: user[field],
                                            onChange: e => setUser({...user, [field]: e.target.value}),
                                            className: 'w-full p-3 border border-gray-300 rounded-lg'
                                        })
                                    )
                                ),
                                
                                React.createElement('div', null,
                                    React.createElement('select', {
                                        value: user.position,
                                        onChange: e => setUser({...user, position: e.target.value}),
                                        className: 'w-full p-3 border border-gray-300 rounded-lg'
                                    },
                                        ['Staff', 'Officer', 'Manager', 'Advisor'].map(pos => 
                                            React.createElement('option', { key: pos, value: pos }, pos)
                                        )
                                    )
                                )
                            ),
                            
                            React.createElement('button', {
                                onClick: handleLogin,
                                className: 'w-full bg-brand-700 text-white py-3 rounded-lg font-bold mt-6 hover:bg-brand-800'
                            }, 'ต่อไป'),
                            
                            React.createElement('button', {
                                onClick: () => setShowAdmin(true),
                                className: 'text-sm text-gray-500 mt-4 flex items-center justify-center gap-2'
                            }, React.createElement(lucide.icons.Settings, { size: 16 }), 'ตั้งค่าระบบ')
                        );
                    
                    case 'rh_selection':
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { title: 'เลือก RH', onBack: () => setView('login') }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 overflow-y-auto' },
                                React.createElement('h3', { className: 'text-lg font-bold mb-4' }, 'เลือก Regional Head'),
                                React.createElement('div', { className: 'space-y-3' },
                                    Object.keys(RH_ZONES).map(rh => 
                                        React.createElement('button', {
                                            key: rh,
                                            onClick: () => handleRHSelect(rh),
                                            className: `w-full p-4 text-left rounded-lg border ${selectedRH === rh ? 'border-brand-500 bg-brand-50' : 'border-gray-200'}`
                                        },
                                            React.createElement('div', { className: 'font-bold' }, rh),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, RH_ZONES[rh].join(', '))
                                        )
                                    )
                                )
                            ),
                            
                            selectedRH && React.createElement('div', { className: 'p-4 border-t' },
                                React.createElement('button', {
                                    onClick: () => setView('zone_selection'),
                                    className: 'w-full bg-brand-700 text-white py-3 rounded-lg font-bold'
                                }, 'เลือก Zone')
                            )
                        );
                    
                    case 'zone_selection':
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { title: 'เลือก Zone', onBack: () => setView('rh_selection') }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 overflow-y-auto' },
                                React.createElement('h3', { className: 'text-lg font-bold mb-4' }, `เลือก Zone ใน ${selectedRH}`),
                                React.createElement('div', { className: 'space-y-3' },
                                    zones.map(zone => 
                                        React.createElement('button', {
                                            key: zone,
                                            onClick: () => handleZoneSelect(zone),
                                            className: `w-full p-4 text-left rounded-lg border ${user.zone === zone ? 'border-brand-500 bg-brand-50' : 'border-gray-200'}`
                                        },
                                            React.createElement('div', { className: 'font-bold' }, zone)
                                        )
                                    )
                                )
                            ),
                            
                            user.zone && React.createElement('div', { className: 'p-4 border-t' },
                                React.createElement('button', {
                                    onClick: () => setView('intro'),
                                    className: 'w-full bg-brand-700 text-white py-3 rounded-lg font-bold'
                                }, 'บันทึกและดำเนินการต่อ')
                            )
                        );
                    
                    case 'intro':
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { title: 'แนะนำระบบ', user }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 overflow-y-auto' },
                                React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'S-P-I-N Framework'),
                                React.createElement('p', { className: 'text-gray-600 mb-6' }, 'ระบบฝึกฝนทักษะการขายด้วย S-P-I-N Framework'),
                                
                                React.createElement('div', { className: 'grid grid-cols-2 gap-3 mb-6' },
                                    ['S', 'P', 'I', 'N'].map(letter => 
                                        React.createElement('div', { key: letter, className: 'bg-white border rounded-lg p-3 text-center' },
                                            React.createElement('div', { 
                                                className: `w-10 h-10 rounded-full flex items-center justify-center text-white font-bold mx-auto mb-2 ${
                                                    letter === 'S' ? 'bg-blue-500' :
                                                    letter === 'P' ? 'bg-red-500' :
                                                    letter === 'I' ? 'bg-amber-500' : 'bg-emerald-500'
                                                }`
                                            }, letter),
                                            React.createElement('div', { className: 'text-sm font-medium' },
                                                letter === 'S' ? 'สถานการณ์' :
                                                letter === 'P' ? 'ปัญหา' :
                                                letter === 'I' ? 'ผลกระทบ' : 'ทางแก้'
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { className: 'space-y-4 mb-8' },
                                    [
                                        { step: 1, title: 'เลือกหลักสูตร', desc: 'MAMA1 หรือ MAMA2' },
                                        { step: 2, title: 'ศึกษาโจทย์', desc: 'ทำความเข้าใจสถานการณ์' },
                                        { step: 3, title: 'บันทึกเสียง', desc: 'ตอบข้อโต้แย้งลูกค้า' },
                                        { step: 4, title: 'รับผลประเมิน', desc: 'วิเคราะห์โดย AI' }
                                    ].map(item => 
                                        React.createElement('div', { key: item.step, className: 'flex items-center gap-4' },
                                            React.createElement('div', { className: 'w-8 h-8 bg-brand-100 text-brand-700 rounded-full flex items-center justify-center font-bold' }, item.step),
                                            React.createElement('div', null,
                                                React.createElement('h4', { className: 'font-bold' }, item.title),
                                                React.createElement('p', { className: 'text-sm text-gray-600' }, item.desc)
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('button', {
                                    onClick: () => setView('menu'),
                                    className: 'w-full bg-brand-700 text-white py-4 rounded-xl font-bold hover:bg-brand-800'
                                }, 'เริ่มการฝึกฝน')
                            )
                        );
                    
                    case 'menu':
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { title: 'เมนูหลัก', user }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 overflow-y-auto' },
                                React.createElement('h3', { className: 'text-lg font-bold mb-4' }, 'เลือกหลักสูตร'),
                                
                                React.createElement('div', { className: 'space-y-4' },
                                    [
                                        { id: 'mama1', title: 'MAMA1 (พื้นฐาน)', desc: 'ฝึกการเปิดบทสนทนาจากธุรกรรม', color: 'border-blue-200 bg-blue-50' },
                                        { id: 'mama2', title: 'MAMA2 (ขั้นสูง)', desc: 'ฝึกการวิเคราะห์และเชื่อมโยงผลิตภัณฑ์', color: 'border-purple-200 bg-purple-50' },
                                        { id: 'other', title: 'Other (อื่นๆ)', desc: 'บทบาทสมมติอื่นๆ', color: 'border-amber-200 bg-amber-50' }
                                    ].map(item => 
                                        React.createElement('button', {
                                            key: item.id,
                                            onClick: () => item.id === 'other' ? setView('other_menu') : handleCourseSelect(item.id),
                                            className: `w-full p-5 rounded-xl border ${item.color} text-left card-hover ${loading ? 'opacity-50' : ''}`
                                        },
                                            React.createElement('h4', { className: 'font-bold text-lg mb-1' }, item.title),
                                            React.createElement('p', { className: 'text-sm text-gray-600' }, item.desc),
                                            loading && course === item.id &&
                                            React.createElement('div', { className: 'flex justify-center mt-2' },
                                                React.createElement(lucide.icons.Loader2, { className: 'animate-spin', size: 20 })
                                            )
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { className: 'mt-8 pt-6 border-t' },
                                    React.createElement('button', {
                                        onClick: () => {
                                            localStorage.clear();
                                            setView('passcode');
                                        },
                                        className: 'text-red-600 flex items-center gap-2'
                                    }, React.createElement(lucide.icons.LogOut, { size: 16 }), 'ออกจากระบบ')
                                )
                            )
                        );
                    
                    case 'other_menu':
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { title: 'Other Scenarios', onBack: () => setView('menu') }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 overflow-y-auto' },
                                otherScenarios.length > 0 ? 
                                    React.createElement('div', { className: 'space-y-3' },
                                        otherScenarios.map(scenario => 
                                            React.createElement('button', {
                                                key: scenario.id,
                                                onClick: () => handleOtherScenarioSelect(scenario),
                                                className: 'w-full p-4 border border-gray-200 rounded-lg text-left hover:border-brand-300'
                                            },
                                                React.createElement('h4', { className: 'font-bold' }, scenario.title),
                                                React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, scenario.description)
                                            )
                                        )
                                    ) :
                                    React.createElement('div', { className: 'text-center py-8' },
                                        React.createElement(lucide.icons.FileText, { className: 'mx-auto text-gray-400 mb-2', size: 48 }),
                                        React.createElement('p', { className: 'text-gray-500' }, 'ไม่มีสถานการณ์อื่นๆ')
                                    )
                            )
                        );
                    
                    case 'scenario':
                        if (!currentScenario) {
                            return React.createElement('div', { className: 'flex-1 flex items-center justify-center' },
                                React.createElement('p', null, 'ไม่พบข้อมูลสถานการณ์')
                            );
                        }
                        
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { 
                                title: currentScenario.title, 
                                user,
                                onBack: () => course === 'other' ? setView('other_menu') : setView('menu')
                            }),
                            
                            React.createElement('div', { className: 'flex-1 overflow-y-auto p-6 pb-24' },
                                React.createElement('div', { className: 'space-y-6' },
                                    // S-P-I-N Sections
                                    ['S', 'P', 'I', 'N'].map(letter => {
                                        const labels = { S: 'สถานการณ์', P: 'ปัญหา', I: 'ผลกระทบ', N: 'ทางแก้ไข' };
                                        const colors = { S: 'blue', P: 'red', I: 'amber', N: 'emerald' };
                                        const field = letter === 'S' ? 'situation' : letter === 'P' ? 'problem' : letter === 'I' ? 'impact' : 'need_payoff';
                                        
                                        return React.createElement('div', { 
                                            key: letter,
                                            className: `p-4 rounded-xl border border-${colors[letter]}-100 bg-${colors[letter]}-50`
                                        },
                                            React.createElement('div', { className: 'flex items-center mb-2' },
                                                React.createElement('div', { 
                                                    className: `w-8 h-8 bg-${colors[letter]}-500 text-white rounded-lg flex items-center justify-center font-bold mr-3`
                                                }, letter),
                                                React.createElement('h3', { className: `font-bold text-${colors[letter]}-900` }, labels[letter])
                                            ),
                                            React.createElement('p', { className: 'text-gray-700' }, currentScenario[field])
                                        );
                                    }),
                                    
                                    // Customer Profile
                                    currentScenario.customer_profile && React.createElement('div', { className: 'p-4 border border-gray-200 rounded-xl' },
                                        React.createElement('h3', { className: 'font-bold mb-3 flex items-center gap-2' },
                                            React.createElement(lucide.icons.User, { size: 20 }),
                                            'ข้อมูลลูกค้า'
                                        ),
                                        React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                                            Object.entries(currentScenario.customer_profile).map(([key, value]) => 
                                                React.createElement('div', { key: key },
                                                    React.createElement('div', { className: 'text-xs text-gray-500 uppercase' }, key),
                                                    React.createElement('div', { className: 'font-medium' }, value)
                                                )
                                            )
                                        )
                                    ),
                                    
                                    // Financial Products
                                    currentScenario.financial_products && React.createElement('div', { className: 'p-4 border border-gray-200 rounded-xl' },
                                        React.createElement('h3', { className: 'font-bold mb-3 flex items-center gap-2' },
                                            React.createElement(lucide.icons.CreditCard, { size: 20 }),
                                            'ผลิตภัณฑ์ทางการเงิน'
                                        ),
                                        React.createElement('div', { className: 'flex flex-wrap gap-2' },
                                            currentScenario.financial_products.map((product, idx) => 
                                                React.createElement('span', { 
                                                    key: idx,
                                                    className: 'px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm'
                                                }, product)
                                            )
                                        )
                                    ),
                                    
                                    // Objectives
                                    currentScenario.objectives && React.createElement('div', { className: 'p-4 border border-gray-200 rounded-xl' },
                                        React.createElement('h3', { className: 'font-bold mb-3 flex items-center gap-2' },
                                            React.createElement(lucide.icons.Target, { size: 20 }),
                                            'เป้าหมายในการฝึก'
                                        ),
                                        React.createElement('ul', { className: 'space-y-2' },
                                            currentScenario.objectives.map((obj, idx) => 
                                                React.createElement('li', { key: idx, className: 'flex items-start gap-2' },
                                                    React.createElement(lucide.icons.CheckCircle, { className: 'text-green-500 mt-0.5 flex-shrink-0', size: 16 }),
                                                    React.createElement('span', null, obj)
                                                )
                                            )
                                        )
                                    )
                                )
                            ),
                            
                            // Start Button
                            React.createElement('div', { className: 'p-4 border-t bg-white' },
                                React.createElement('button', {
                                    onClick: startRoleplay,
                                    className: 'w-full bg-brand-700 text-white py-4 rounded-xl font-bold hover:bg-brand-800 flex items-center justify-center gap-2'
                                },
                                    React.createElement(lucide.icons.Mic, { size: 20 }),
                                    'เริ่มบทบาทสมมติ'
                                )
                            )
                        );
                    
                    case 'record':
                        return React.createElement('div', { className: 'flex-1 flex flex-col bg-gradient-to-b from-brand-900 to-brand-800 text-white' },
                            React.createElement(Header, { 
                                title: 'บันทึกเสียง',
                                user,
                                onBack: () => setView('scenario')
                            }),
                            
                            React.createElement('div', { className: 'flex-1 p-6 flex flex-col' },
                                // Objection
                                React.createElement('div', { className: 'glass-effect p-5 rounded-2xl mb-6' },
                                    React.createElement('div', { className: 'flex items-center gap-2 mb-3' },
                                        React.createElement(lucide.icons.AlertCircle, { size: 20 }),
                                        React.createElement('h3', { className: 'font-bold' }, 'ข้อโต้แย้งจากลูกค้า')
                                    ),
                                    React.createElement('p', { className: 'text-xl italic text-center' }, `"${currentObjection}"`)
                                ),
                                
                                // Timer
                                React.createElement('div', { className: 'text-center mb-6' },
                                    React.createElement('div', { className: 'text-5xl font-mono mb-4' },
                                        Math.floor(timer / 60).toString().padStart(2, '0'),
                                        ':',
                                        (timer % 60).toString().padStart(2, '0')
                                    ),
                                    recordingState === 'recording' && React.createElement('div', { className: 'flex justify-center gap-1' },
                                        [...Array(8)].map((_, i) => 
                                            React.createElement('div', {
                                                key: i,
                                                className: 'w-1.5 bg-red-400 rounded-full animate-pulse',
                                                style: { 
                                                    height: `${Math.random() * 24 + 8}px`,
                                                    animationDelay: `${i * 0.1}s`
                                                }
                                            })
                                        )
                                    )
                                ),
                                
                                // Transcript
                                transcript && React.createElement('div', { className: 'glass-effect p-4 rounded-xl mb-6' },
                                    React.createElement('h4', { className: 'font-bold mb-2 text-sm' }, 'ข้อความจากการบันทึกเสียง:'),
                                    React.createElement('p', { className: 'text-sm' }, transcript)
                                ),
                                
                                // Controls
                                React.createElement('div', { className: 'mt-auto' },
                                    recordingState === 'idle' ? 
                                        React.createElement('button', {
                                            onClick: startRecording,
                                            className: 'w-24 h-24 bg-white text-brand-900 rounded-full flex items-center justify-center mx-auto shadow-lg hover:scale-105'
                                        }, React.createElement(lucide.icons.Mic, { size: 32 })) :
                                    
                                    recordingState === 'recording' ?
                                        React.createElement('button', {
                                            onClick: stopRecording,
                                            className: 'w-24 h-24 bg-red-500 text-white rounded-full flex items-center justify-center mx-auto animate-pulse'
                                        }, React.createElement(lucide.icons.Square, { size: 24 })) :
                                    
                                    // Preview state
                                    React.createElement('div', { className: 'space-y-4' },
                                        React.createElement('div', { className: 'flex gap-3' },
                                            React.createElement('button', {
                                                onClick: () => {
                                                    if (audioBlob) {
                                                        const audio = new Audio(URL.createObjectURL(audioBlob));
                                                        audio.play();
                                                    }
                                                },
                                                className: 'flex-1 glass-effect py-3 rounded-xl font-bold flex items-center justify-center gap-2'
                                            },
                                                React.createElement(lucide.icons.Volume2, { size: 20 }),
                                                'ฟังเสียง'
                                            ),
                                            React.createElement('button', {
                                                onClick: () => {
                                                    setRecordingState('idle');
                                                    setAudioBlob(null);
                                                    setTranscript('');
                                                },
                                                className: 'flex-1 glass-effect py-3 rounded-xl font-bold flex items-center justify-center gap-2'
                                            },
                                                React.createElement(lucide.icons.RefreshCw, { size: 20 }),
                                                'บันทึกใหม่'
                                            )
                                        ),
                                        React.createElement('button', {
                                            onClick: submitForEvaluation,
                                            className: 'w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-4 rounded-xl font-bold hover:shadow-lg'
                                        }, 'ส่งให้ AI ประเมินผล')
                                    )
                                )
                            )
                        );
                    
                    case 'processing':
                        return React.createElement('div', { className: 'flex-1 flex flex-col items-center justify-center' },
                            React.createElement('div', { className: 'relative mb-8' },
                                React.createElement('div', { className: 'w-24 h-24 border-4 border-brand-100 border-t-brand-500 rounded-full animate-spin' }),
                                React.createElement('div', { className: 'absolute inset-0 flex items-center justify-center' },
                                    React.createElement(MamaLogo, { size: 'medium' })
                                )
                            ),
                            React.createElement('h2', { className: 'text-2xl font-bold text-brand-900 mb-2' }, 'AI กำลังวิเคราะห์...'),
                            React.createElement('p', { className: 'text-gray-600' }, 'ประเมินผลตาม S-P-I-N Framework')
                        );
                    
                    case 'result':
                        if (!result) {
                            return React.createElement('div', { className: 'flex-1 flex items-center justify-center' },
                                React.createElement('p', null, 'ไม่พบผลการประเมิน')
                            );
                        }
                        
                        return React.createElement('div', { className: 'flex-1 flex flex-col' },
                            React.createElement(Header, { 
                                title: 'ผลการประเมิน',
                                user,
                                onBack: () => setView('menu')
                            }),
                            
                            React.createElement('div', { className: 'flex-1 overflow-y-auto p-6' },
                                React.createElement('div', { className: 'space-y-6' },
                                    // Total Score
                                    React.createElement('div', { className: 'spin-gradient text-white p-8 rounded-3xl text-center' },
                                        React.createElement('div', { className: 'text-6xl font-black mb-2' }, result.total),
                                        React.createElement('div', { className: 'text-sm opacity-90 mb-4' }, 'คะแนนรวม'),
                                        React.createElement('div', { className: `inline-block px-4 py-1 rounded-full text-sm font-bold ${result.isPassed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}` },
                                            result.isPassed ? 'ผ่านเกณฑ์ ✓' : 'ต้องปรับปรุง ✗'
                                        )
                                    ),
                                    
                                    // S-P-I-N Scores
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'text-lg font-bold mb-4' }, 'คะแนน S-P-I-N Framework'),
                                        React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                                            Object.entries(result.spin_scores || {}).map(([letter, [score, feedback]]) => 
                                                React.createElement('div', { key: letter },
                                                    React.createElement(SpinBadge, { type: letter, score: score }),
                                                    React.createElement('p', { className: 'text-xs text-gray-600 mt-2 text-center' }, feedback)
                                                )
                                            )
                                        )
                                    ),
                                    
                                    // AI Advice
                                    React.createElement('div', { className: 'bg-blue-50 border border-blue-100 rounded-xl p-5' },
                                        React.createElement('h3', { className: 'font-bold text-blue-900 mb-3 flex items-center gap-2' },
                                            React.createElement(lucide.icons.Headphones, { size: 20 }),
                                            'คำแนะนำจาก AI'
                                        ),
                                        React.createElement('p', { className: 'text-gray-700' }, result.aiAdvise)
                                    ),
                                    
                                    // Suggested Improvements
                                    result.suggested_improvements && React.createElement('div', { className: 'bg-amber-50 border border-amber-100 rounded-xl p-5' },
                                        React.createElement('h3', { className: 'font-bold text-amber-900 mb-3 flex items-center gap-2' },
                                            React.createElement(lucide.icons.Zap, { size: 20 }),
                                            'ข้อแนะนำสำหรับการพัฒนา'
                                        ),
                                        React.createElement('ul', { className: 'space-y-2' },
                                            result.suggested_improvements.map((item, idx) => 
                                                React.createElement('li', { key: idx, className: 'flex items-start gap-2' },
                                                    React.createElement(lucide.icons.CheckCircle, { className: 'text-green-500 mt-0.5', size: 16 }),
                                                    React.createElement('span', null, item)
                                                )
                                            )
                                        )
                                    ),
                                    
                                    // Actions
                                    React.createElement('div', { className: 'space-y-3' },
                                        React.createElement('button', {
                                            onClick: () => {
                                                const courseScenarios = scenarios[course] || [];
                                                if (courseScenarios.length > 0) {
                                                    const randomIndex = Math.floor(Math.random() * courseScenarios.length);
                                                    setCurrentScenario(courseScenarios[randomIndex]);
                                                }
                                                setView('scenario');
                                            },
                                            className: 'w-full bg-brand-700 text-white py-3 rounded-lg font-bold hover:bg-brand-800'
                                        }, 'ฝึกอีกครั้ง'),
                                        
                                        React.createElement('button', {
                                            onClick: () => setView('menu'),
                                            className: 'w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-50'
                                        }, 'กลับสู่เมนูหลัก')
                                    )
                                )
                            ),
                            
                            // Admin Button
                            React.createElement('button', {
                                onClick: () => setShowAdmin(true),
                                className: 'absolute bottom-4 right-4 p-2 bg-gray-800 text-white rounded-full'
                            }, React.createElement(lucide.icons.Settings, { size: 20 }))
                        );
                    
                    default:
                        return React.createElement('div', { className: 'flex-1 flex items-center justify-center' },
                            React.createElement('p', null, 'ไม่พบหน้านี้')
                        );
                }
            };
            
            // Admin Panel Component
            const AdminPanel = () => {
                const [activeTab, setActiveTab] = useState('settings');
                const [apiKey, setApiKey] = useState(geminiKey);
                const [message, setMessage] = useState('');
                const [scenarioForm, setScenarioForm] = useState({
                    course: 'mama1',
                    title: '',
                    situation: '',
                    problem: '',
                    impact: '',
                    need_payoff: ''
                });
                
                const saveApiKey = () => {
                    localStorage.setItem('mama_gemini_key', apiKey);
                    setGeminiKey(apiKey);
                    setMessage('บันทึก API Key สำเร็จ!');
                    setTimeout(() => setMessage(''), 3000);
                };
                
                const saveScenario = () => {
                    // In a real app, this would save to Supabase
                    alert('ฟังก์ชันบันทึกสถานการณ์: ในระบบจริงจะบันทึกลงฐานข้อมูล');
                    setScenarioForm({
                        course: 'mama1',
                        title: '',
                        situation: '',
                        problem: '',
                        impact: '',
                        need_payoff: ''
                    });
                };
                
                return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                    React.createElement('div', { className: 'bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col' },
                        // Header
                        React.createElement('div', { className: 'bg-brand-900 text-white p-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                                React.createElement('h2', { className: 'text-xl font-bold' }, 'ระบบจัดการแอดมิน'),
                                React.createElement('button', {
                                    onClick: () => setShowAdmin(false),
                                    className: 'p-1 hover:bg-white/10 rounded'
                                }, React.createElement(lucide.icons.X, { size: 24 }))
                            ),
                            React.createElement('p', { className: 'text-brand-200 text-sm' }, 'จัดการข้อมูลระบบ MAMA Roleplay')
                        ),
                        
                        // Tabs
                        React.createElement('div', { className: 'flex border-b' },
                            ['settings', 'scenarios', 'reports'].map(tab => 
                                React.createElement('button', {
                                    key: tab,
                                    onClick: () => setActiveTab(tab),
                                    className: `flex-1 py-3 text-sm font-medium ${activeTab === tab ? 'text-brand-600 border-b-2 border-brand-600' : 'text-gray-500'}`
                                },
                                    tab === 'settings' ? 'ตั้งค่าระบบ' :
                                    tab === 'scenarios' ? 'สถานการณ์' : 'รายงาน'
                                )
                            )
                        ),
                        
                        // Content
                        React.createElement('div', { className: 'flex-1 overflow-y-auto p-6' },
                            message && React.createElement('div', { 
                                className: `p-3 rounded-lg mb-4 ${message.includes('สำเร็จ') ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`
                            }, message),
                            
                            activeTab === 'settings' ?
                                React.createElement('div', { className: 'space-y-6' },
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'ตั้งค่า Gemini API'),
                                        React.createElement('div', { className: 'space-y-4' },
                                            React.createElement('input', {
                                                type: 'password',
                                                value: apiKey,
                                                onChange: e => setApiKey(e.target.value),
                                                placeholder: 'ป้อน Gemini API Key',
                                                className: 'w-full p-3 border border-gray-300 rounded-lg'
                                            }),
                                            React.createElement('p', { className: 'text-sm text-gray-600' },
                                                'ดึง API Key ได้ที่: ',
                                                React.createElement('a', {
                                                    href: 'https://aistudio.google.com/app/apikey',
                                                    target: '_blank',
                                                    className: 'text-brand-600 underline'
                                                }, 'Google AI Studio')
                                            ),
                                            React.createElement('button', {
                                                onClick: saveApiKey,
                                                className: 'w-full bg-gray-800 text-white py-3 rounded-lg font-bold hover:bg-gray-900'
                                            }, 'บันทึก API Key')
                                        )
                                    ),
                                    
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'ข้อมูลระบบ'),
                                        React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg' },
                                            React.createElement('div', { className: 'space-y-2 text-sm' },
                                                React.createElement('div', { className: 'flex' },
                                                    React.createElement('span', { className: 'font-medium w-32' }, 'เวอร์ชัน:'), '3.0'
                                                ),
                                                React.createElement('div', { className: 'flex' },
                                                    React.createElement('span', { className: 'font-medium w-32' }, 'สถานการณ์ MAMA1:'), '10 รายการ'
                                                ),
                                                React.createElement('div', { className: 'flex' },
                                                    React.createElement('span', { className: 'font-medium w-32' }, 'สถานการณ์ MAMA2:'), '10 รายการ'
                                                ),
                                                React.createElement('div', { className: 'flex' },
                                                    React.createElement('span', { className: 'font-medium w-32' }, 'S-P-I-N Framework:'), 'เปิดใช้งาน'
                                                )
                                            )
                                        )
                                    )
                                ) :
                            
                            activeTab === 'scenarios' ?
                                React.createElement('div', { className: 'space-y-6' },
                                    React.createElement('div', null,
                                        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'เพิ่มสถานการณ์ใหม่'),
                                        React.createElement('div', { className: 'space-y-4' },
                                            React.createElement('select', {
                                                value: scenarioForm.course,
                                                onChange: e => setScenarioForm({...scenarioForm, course: e.target.value}),
                                                className: 'w-full p-3 border border-gray-300 rounded-lg'
                                            },
                                                React.createElement('option', { value: 'mama1' }, 'MAMA1 (พื้นฐาน)'),
                                                React.createElement('option', { value: 'mama2' }, 'MAMA2 (ขั้นสูง)')
                                            ),
                                            React.createElement('input', {
                                                type: 'text',
                                                value: scenarioForm.title,
                                                onChange: e => setScenarioForm({...scenarioForm, title: e.target.value}),
                                                placeholder: 'ชื่อสถานการณ์',
                                                className: 'w-full p-3 border border-gray-300 rounded-lg'
                                            }),
                                            React.createElement('textarea', {
                                                value: scenarioForm.situation,
                                                onChange: e => setScenarioForm({...scenarioForm, situation: e.target.value}),
                                                placeholder: 'สถานการณ์ (S)',
                                                className: 'w-full p-3 border border-gray-300 rounded-lg h-24'
                                            }),
                                            React.createElement('textarea', {
                                                value: scenarioForm.problem,
                                                onChange: e => setScenarioForm({...scenarioForm, problem: e.target.value}),
                                                placeholder: 'ปัญหา (P)',
                                                className: 'w-full p-3 border border-gray-300 rounded-lg h-24'
                                            }),
                                            React.createElement('button', {
                                                onClick: saveScenario,
                                                className: 'w-full bg-brand-700 text-white py-3 rounded-lg font-bold hover:bg-brand-800'
                                            }, 'บันทึกสถานการณ์')
                                        )
                                    )
                                ) :
                            
                            // Reports Tab
                            React.createElement('div', null,
                                React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'รายงานผลการฝึก'),
                                React.createElement('div', { className: 'bg-gray-50 p-4 rounded-lg' },
                                    React.createElement('p', { className: 'text-gray-600' }, 'ในระบบจริงจะมีรายงานสถิติการฝึก รายบุคคล และรายกลุ่ม')
                                )
                            )
                        )
                    )
                );
            };
            
            // Main Render
            return React.createElement('div', { className: 'h-full w-full' },
                showAdmin && React.createElement(AdminPanel),
                renderView()
            );
        };
        
        // Render App
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
