<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MAMA: Roleplay AI Assistant - S-P-I-N Framework</title>
    
    <!-- Fonts: Prompt -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        spin: {
                            situation: '#3b82f6',    // Blue for Situation
                            problem: '#ef4444',       // Red for Problem
                            impact: '#f59e0b',        // Orange for Impact
                            need: '#10b981',          // Green for Need
                        }
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'spin-glow': 'spinGlow 2s ease-in-out infinite'
                    },
                    keyframes: {
                        fadeIn: { from: { opacity: 0 }, to: { opacity: 1 } },
                        slideIn: { from: { transform: 'translateY(10px)', opacity: 0 }, to: { transform: 'translateY(0)', opacity: 1 } },
                        spinGlow: {
                            '0%, 100%': { boxShadow: '0 0 5px rgba(59, 130, 246, 0.5)' },
                            '50%': { boxShadow: '0 0 20px rgba(59, 130, 246, 0.8)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .spin-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #ef4444 33%, #f59e0b 66%, #10b981 100%);
        }
        
        .text-gradient-spin {
            background: linear-gradient(90deg, #3b82f6, #ef4444, #f59e0b, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .recording-pulse {
            animation: recording-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes recording-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .spin-badge {
            position: relative;
            overflow: hidden;
        }
        
        .spin-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #ef4444, #f59e0b, #10b981);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen flex justify-center items-center p-4">
    
    <div id="root" class="w-full max-w-md bg-white shadow-2xl rounded-3xl overflow-hidden flex flex-col relative h-[90vh]"></div>

    <script type="module">
        // Import Supabase
        const { createClient } = supabase;
        
        // Supabase Configuration
        const SUPABASE_URL = 'https://iuwszegqtgtvupavoucv.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1d3N6ZWdxdGd0dnVwYXZvdWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3ODE3MDIsImV4cCI6MjA4NTM1NzcwMn0.z5DmbtLgULN-DjOnM6PrD9puKmKS_vd2rD5hp0huM6g';
        
        // Create Supabase client
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // RH Zone Data
        const RH_ZONE_DATA = {
            'RH1': [
                { code: 'Z1', name: 'จตุจักร' },
                { code: 'Z2', name: 'ธนบุรี' },
                { code: 'Z3', name: 'บางกะปิ' },
                { code: 'Z4', name: 'สาทร' },
                { code: 'Z5', name: 'สุขุมวิท' }
            ],
            'RH2': [
                { code: 'Z6', name: 'ชลบุรี' },
                { code: 'Z7', name: 'บางนา' },
                { code: 'Z8', name: 'พัทยา' },
                { code: 'Z9', name: 'ระยอง' }
            ],
            'RH3': [
                { code: 'Z10', name: 'เชียงใหม่' },
                { code: 'Z11', name: 'นครสวรรค์' },
                { code: 'Z12', name: 'นนทบุรี' },
                { code: 'Z13', name: 'พิษณุโลก' },
                { code: 'Z14', name: 'อยุธยา' }
            ],
            'RH4': [
                { code: 'Z15', name: 'ดอนเมือง' },
                { code: 'Z16', name: 'นครราชสีมา' },
                { code: 'Z17', name: 'สระบุรี' },
                { code: 'Z18', name: 'อุดรธานี' },
                { code: 'Z19', name: 'อุบลราชธานี' }
            ],
            'RH5': [
                { code: 'Z20', name: 'ภูเก็ต' },
                { code: 'Z21', name: 'ราชบุรี' },
                { code: 'Z22', name: 'สมุทรสาคร' },
                { code: 'Z23', name: 'สุราษฎร์ธานี' },
                { code: 'Z24', name: 'หาดใหญ่' }
            ]
        };
        
        // Icons
        const Icons = {
            Mic: () => lucide.Mic(),
            Square: () => lucide.Square(),
            Play: () => lucide.Play(),
            Award: () => lucide.Award(),
            User: () => lucide.User(),
            Settings: () => lucide.Settings(),
            CheckCircle: () => lucide.CheckCircle(),
            FileText: () => lucide.FileText(),
            LogOut: () => lucide.LogOut(),
            AlertCircle: () => lucide.AlertCircle(),
            RefreshCw: () => lucide.RefreshCw(),
            ArrowRight: () => lucide.ArrowRight(),
            Volume2: () => lucide.Volume2(),
            Info: () => lucide.Info(),
            Headphones: () => lucide.Headphones(),
            X: () => lucide.X(),
            Database: () => lucide.Database(),
            Wifi: () => lucide.Wifi(),
            Loader2: () => lucide.Loader2(),
            Lock: () => lucide.Lock(),
            Star: () => lucide.Star(),
            MessageSquare: () => lucide.MessageSquare(),
            BarChart3: () => lucide.BarChart3(),
            Edit: () => lucide.Edit(),
            Trash2: () => lucide.Trash2(),
            Plus: () => lucide.Plus(),
            Save: () => lucide.Save(),
            Search: () => lucide.Search(),
            Filter: () => lucide.Filter(),
            Download: () => lucide.Download(),
            Upload: () => lucide.Upload(),
            Eye: () => lucide.Eye(),
            EyeOff: () => lucide.EyeOff(),
            ChevronRight: () => lucide.ChevronRight(),
            ChevronLeft: () => lucide.ChevronLeft(),
            Calendar: () => lucide.Calendar(),
            Clock: () => lucide.Clock(),
            Phone: () => lucide.Phone(),
            Mail: () => lucide.Mail(),
            Home: () => lucide.Home(),
            Briefcase: () => lucide.Briefcase(),
            DollarSign: () => lucide.DollarSign(),
            CreditCard: () => lucide.CreditCard(),
            Shield: () => lucide.Shield(),
            TrendingUp: () => lucide.TrendingUp(),
            HelpCircle: () => lucide.HelpCircle(),
            ThumbsUp: () => lucide.ThumbsUp(),
            ThumbsDown: () => lucide.ThumbsDown(),
            MapPin: () => lucide.MapPin(),
            Users: () => lucide.Users(),
            Target: () => lucide.Target(),
            Zap: () => lucide.Zap(),
            PieChart: () => lucide.PieChart()
        };
        
        // Helper Components
        const MamaLogo = ({ className = "w-10 h-10" }) => {
            return React.createElement('div', {
                className: `bg-gradient-to-br from-brand-600 to-brand-800 rounded-xl flex items-center justify-center text-white font-black text-lg ${className}`
            }, "MAMA");
        };
        
        const Header = ({ title = "MAMA", user, onBack, showBack = false }) => {
            return React.createElement('div', {
                className: "bg-white border-b border-gray-100 px-5 py-4 flex items-center justify-between shadow-sm"
            },
            React.createElement('div', {
                className: "flex items-center space-x-3"
            },
            showBack && React.createElement('button', {
                onClick: onBack,
                className: "p-1 rounded-lg hover:bg-gray-100"
            }, Icons.ChevronLeft({ size: 24, className: "text-gray-600" })),
            React.createElement(MamaLogo, { className: "w-9 h-9" }),
            React.createElement('span', {
                className: "font-extrabold text-brand-900 tracking-tight text-lg"
            }, title)),
            user && user.firstName && React.createElement('div', {
                className: "flex flex-col items-end"
            },
            React.createElement('span', {
                className: "text-sm font-bold text-gray-800"
            }, user.firstName),
            React.createElement('span', {
                className: "text-xs text-gray-500 font-medium"
            }, `${user.rh_code || ''} ${user.zone_name || ''}`)));
        };
        
        const AudioVisualizer = ({ isRecording }) => {
            const [heights, setHeights] = React.useState([4, 4, 4, 4, 4, 4, 4, 4]);
            
            React.useEffect(() => {
                if (!isRecording) {
                    setHeights([4, 4, 4, 4, 4, 4, 4, 4]);
                    return;
                }
                
                const interval = setInterval(() => {
                    setHeights(Array.from({ length: 8 }, () => Math.random() * 24 + 4));
                }, 150);
                
                return () => clearInterval(interval);
            }, [isRecording]);
            
            return React.createElement('div', {
                className: "flex items-center justify-center space-x-1 h-8"
            },
            heights.map((height, i) => React.createElement('div', {
                key: i,
                className: `w-1.5 bg-brand-500 rounded-full transition-all duration-300 ${isRecording ? 'animate-pulse' : 'opacity-30'}`,
                style: { height: `${height}px`, animationDelay: `${i * 0.1}s` }
            })));
        };
        
        const SpinBadge = ({ type, score, max = 25 }) => {
            const colors = {
                situation: { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-200' },
                problem: { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-200' },
                impact: { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-200' },
                need: { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-200' }
            };
            
            const labels = {
                situation: 'สถานการณ์ (S)',
                problem: 'ปัญหา (P)',
                impact: 'ผลกระทบ (I)',
                need: 'ทางแก้ (N)'
            };
            
            const color = colors[type] || colors.situation;
            const percentage = (score / max) * 100;
            
            return React.createElement('div', {
                className: `p-4 rounded-xl border ${color.border} ${color.bg} flex flex-col items-center justify-center shadow-sm`
            },
            React.createElement('div', {
                className: `text-2xl font-black ${color.text}`
            }, score),
            React.createElement('div', {
                className: "text-xs font-bold text-gray-500 uppercase mt-1"
            }, labels[type]),
            React.createElement('div', {
                className: "w-full bg-gray-200 rounded-full h-1.5 mt-2"
            },
            React.createElement('div', {
                className: `h-1.5 rounded-full ${color.bg.replace('100', '500')}`,
                style: { width: `${percentage}%` }
            })));
        };
        
        const PasscodeScreen = ({ onPasscodeCorrect }) => {
            const [passcode, setPasscode] = React.useState('');
            const [error, setError] = React.useState(false);
            const [showPassword, setShowPassword] = React.useState(false);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (passcode.toLowerCase() === 'mama') {
                    localStorage.setItem('mama_passcode_verified', 'true');
                    onPasscodeCorrect();
                } else {
                    setError(true);
                    setTimeout(() => setError(false), 1000);
                }
            };
            
            React.useEffect(() => {
                if (localStorage.getItem('mama_passcode_verified') === 'true') {
                    onPasscodeCorrect();
                }
            }, []);
            
            return React.createElement('div', {
                className: "flex-1 bg-gradient-to-br from-brand-50 via-white to-brand-100 flex flex-col justify-center items-center p-8"
            },
            React.createElement('div', {
                className: "text-center mb-8"
            },
            React.createElement('div', {
                className: "w-24 h-24 spin-gradient rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg"
            },
            React.createElement('span', {
                className: "text-white font-black text-2xl"
            }, "SPIN")),
            React.createElement('h1', {
                className: "text-3xl font-black text-gradient-spin mb-2"
            }, "MAMA Roleplay"),
            React.createElement('p', {
                className: "text-gray-600 text-sm"
            }, "ฝึกฝนทักษะการขายด้วย S-P-I-N Framework")),
            
            React.createElement('form', {
                onSubmit: handleSubmit,
                className: "w-full max-w-xs space-y-4"
            },
            React.createElement('div', {
                className: "relative"
            },
            React.createElement('input', {
                type: showPassword ? "text" : "password",
                value: passcode,
                onChange: (e) => setPasscode(e.target.value),
                className: `w-full p-4 rounded-xl border-2 ${error ? 'border-red-500 bg-red-50' : 'border-brand-200'} focus:border-brand-500 focus:outline-none transition-colors`,
                placeholder: "กรอก Passcode",
                autoFocus: true
            }),
            React.createElement('button', {
                type: "button",
                onClick: () => setShowPassword(!showPassword),
                className: "absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500"
            }, showPassword ? Icons.EyeOff({ size: 20 }) : Icons.Eye({ size: 20 }))),
            
            error && React.createElement('div', {
                className: "text-red-500 text-sm text-center animate-pulse"
            }, "❌ Passcode ไม่ถูกต้อง"),
            
            React.createElement('button', {
                type: "submit",
                className: "w-full spin-gradient text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all"
            }, "เข้าสู่ระบบ"),
            
            React.createElement('p', {
                className: "text-xs text-gray-500 text-center mt-4"
            }, "Passcode: mama (ตัวใหญ่หรือเล็กก็ได้)")));
        };
        
        // Main App Component
        const App = () => {
            const [view, setView] = React.useState('passcode');
            const [user, setUser] = React.useState({ 
                empId: '', 
                firstName: '', 
                lastName: '', 
                position: 'Staff',
                rh_code: '',
                zone_code: '',
                zone_name: ''
            });
            const [rhZones, setRhZones] = React.useState([]);
            const [zones, setZones] = React.useState([]);
            const [course, setCourse] = React.useState(null);
            const [currentScenario, setCurrentScenario] = React.useState(null);
            const [loading, setLoading] = React.useState(false);
            const [scenarios, setScenarios] = React.useState({ mama1: [], mama2: [] });
            const [prompts, setPrompts] = React.useState({ mama1: null, mama2: null });
            const [recordingState, setRecordingState] = React.useState('idle');
            const [audioBlob, setAudioBlob] = React.useState(null);
            const [transcript, setTranscript] = React.useState('');
            const [isSTTSupported, setIsSTTSupported] = React.useState(true);
            const [timer, setTimer] = React.useState(0);
            const [currentObjection, setCurrentObjection] = React.useState('');
            const [result, setResult] = React.useState(null);
            const [showAdmin, setShowAdmin] = React.useState(false);
            const [geminiKey, setGeminiKey] = React.useState('');
            const [objections, setObjections] = React.useState([]);
            
            // Refs
            const timerRef = React.useRef(null);
            const recognitionRef = React.useRef(null);
            const mediaRecorderRef = React.useRef(null);
            const audioChunksRef = React.useRef([]);
            const audioPreviewRef = React.useRef(null);
            
            // Initialize
            React.useEffect(() => {
                // Check STT support
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    setIsSTTSupported(false);
                    console.warn('Speech Recognition not supported');
                }
                
                // Load saved user
                const savedUser = localStorage.getItem('mama_user');
                if (savedUser) {
                    try {
                        const parsedUser = JSON.parse(savedUser);
                        setUser(parsedUser);
                        // If user already has RH and Zone, go to menu
                        if (parsedUser.rh_code && parsedUser.zone_code) {
                            setView('menu');
                        }
                    } catch (e) {
                        console.error('Error parsing saved user:', e);
                    }
                }
                
                // Load Gemini key
                const savedGeminiKey = localStorage.getItem('mama_gemini_key');
                if (savedGeminiKey) {
                    setGeminiKey(savedGeminiKey);
                }
                
                // Fetch initial data
                fetchInitialData();
            }, []);
            
            // Fetch data from Supabase
            const fetchInitialData = async () => {
                try {
                    // Fetch RH Zones
                    const { data: rhData, error: rhError } = await supabaseClient
                        .from('rh_zones')
                        .select('*')
                        .eq('is_active', true)
                        .order('rh_code');
                    
                    if (!rhError && rhData) {
                        setRhZones(rhData);
                    }
                    
                    // Fetch scenarios
                    const { data: scenarioData, error: scenarioError } = await supabaseClient
                        .from('scenarios')
                        .select('*')
                        .eq('is_active', true);
                    
                    if (!scenarioError && scenarioData) {
                        const grouped = {
                            mama1: scenarioData.filter(s => s.course === 'mama1'),
                            mama2: scenarioData.filter(s => s.course === 'mama2')
                        };
                        setScenarios(grouped);
                    }
                    
                    // Fetch prompts
                    const { data: promptData, error: promptError } = await supabaseClient
                        .from('prompts')
                        .select('*')
                        .eq('is_default', true);
                    
                    if (!promptError && promptData) {
                        const grouped = {};
                        promptData.forEach(p => {
                            grouped[p.course] = p;
                        });
                        setPrompts(grouped);
                    }
                    
                    // Fetch Gemini key from config
                    const { data: configData, error: configError } = await supabaseClient
                        .from('config')
                        .select('*')
                        .eq('key_name', 'gemini_api_key');
                    
                    if (!configError && configData && configData.length > 0) {
                        const key = configData[0].key_value;
                        if (key && key !== 'YOUR_GEMINI_API_KEY_HERE') {
                            setGeminiKey(key);
                            localStorage.setItem('mama_gemini_key', key);
                        }
                    }
                    
                } catch (error) {
                    console.error('Error fetching initial data:', error);
                }
            };
            
            // Handle RH selection
            const handleRhSelect = (rhCode) => {
                setUser({...user, rh_code: rhCode, zone_code: '', zone_name: ''});
                // Filter zones for selected RH
                const filteredZones = rhZones.filter(zone => zone.rh_code === rhCode);
                setZones(filteredZones);
            };
            
            // Handle Zone selection
            const handleZoneSelect = (zoneCode, zoneName) => {
                setUser({...user, zone_code: zoneCode, zone_name: zoneName});
            };
            
            // Save user and proceed
            const saveUserAndProceed = () => {
                if (!user.empId || !user.firstName || !user.rh_code || !user.zone_code) {
                    alert('กรุณากรอกข้อมูลให้ครบถ้วน');
                    return;
                }
                
                localStorage.setItem('mama_user', JSON.stringify(user));
                setView('intro');
            };
            
            // Course selection
            const handleCourseSelect = async (selectedCourse) => {
                setLoading(true);
                setCourse(selectedCourse);
                
                // Get scenarios for selected course
                const courseScenarios = scenarios[selectedCourse] || [];
                
                if (courseScenarios.length === 0) {
                    // Fallback scenarios
                    const fallbackScenarios = {
                        mama1: [
                            {
                                id: "fallback-1",
                                title: "ลูกค้าฝากเงินประจำอัตราดอกเบี้ยต่ำ",
                                situation: "ลูกค้าวัย 60 ปี มาสาขาเพื่อฝากเงินประจำ 500,000 บาท อัตราดอกเบี้ย 0.5% ต่อปี",
                                problem: "ดอกเบี้ยต่ำกว่าอัตราเงินเฟ้อ ทำให้มูลค่าจริงของเงินลดลง",
                                impact: "เงิน 500,000 บาท ใน 1 ปี จะเหลือมูลค่าจริงเพียง 492,500 บาท (คิดจากอัตราเงินเฟ้อ 2%)",
                                need_payoff: "แนะนำบัญชีเงินฝากที่ให้ดอกเบี้ยสูงขึ้นหรือกองทุนตลาดเงินเพื่อรักษามูลค่าของเงิน",
                                customer_profile: { name: "คุณสมหมาย", age: "60", occupation: "เกษียณราชการ" },
                                financial_products: ["เงินฝากประจำ", "บัญชีออมทรัพย์"],
                                time_limit: "4 นาที",
                                objectives: ["สร้างความสัมพันธ์กับลูกค้า", "อธิบายผลกระทบของดอกเบี้ยต่ำ", "แนะนำทางเลือกที่เหมาะสม"]
                            }
                        ],
                        mama2: [
                            {
                                id: "fallback-2",
                                title: "ลูกค้ามีพอร์ตการลงทุนกระจุกตัว",
                                situation: "ลูกค้าวัย 45 ปี มีพอร์ตการลงทุน 5 ล้านบาท ลงทุนในหุ้นไทยเพียงอย่างเดียว 70%",
                                problem: "ความเสี่ยงสูงจากการกระจุกตัวในสินทรัพย์ประเภทเดียว",
                                impact: "หากตลาดหุ้นไทยปรับตัวลดลง 20% ลูกค้าจะสูญเสีย 700,000 บาท และฟื้นตัวช้า",
                                need_payoff: "แนะนำการกระจายพอร์ตการลงทุนระหว่างประเทศและสินทรัพย์อื่นๆ",
                                customer_profile: { name: "คุณกอบเกียรติ", age: "45", occupation: "นักธุรกิจ" },
                                financial_products: ["หุ้นไทย 3.5M", "เงินฝาก 1M", "กองทุนหุ้นไทย 0.5M"],
                                time_limit: "8 นาที",
                                objectives: ["วิเคราะห์ความเสี่ยงจากความกระจุกตัว", "คำนวณผลกระทบจากตลาดขาลง", "เสนอแผนการกระจายพอร์ต"]
                            }
                        ]
                    };
                    
                    const randomScenario = fallbackScenarios[selectedCourse][0];
                    setCurrentScenario(randomScenario);
                    
                    // Fetch objections for the scenario
                    const scenarioObjections = [
                        "ไม่กล้าเปลี่ยน เดี๋ยวเงินหาย",
                        "เคยลงทุนแล้วขาดทุน ไม่มั่นใจ",
                        "ขอดูก่อน คิดอีกที"
                    ];
                    setObjections(scenarioObjections);
                } else {
                    // Randomly select a scenario
                    const randomIndex = Math.floor(Math.random() * courseScenarios.length);
                    const selectedScenario = courseScenarios[randomIndex];
                    setCurrentScenario(selectedScenario);
                    
                    // Fetch objections for the scenario
                    try {
                        const { data: objectionData, error: objectionError } = await supabaseClient
                            .from('objections')
                            .select('*')
                            .eq('scenario_id', selectedScenario.id)
                            .eq('is_active', true);
                        
                        if (!objectionError && objectionData) {
                            setObjections(objectionData.map(obj => obj.objection_text));
                        } else {
                            // Fallback objections
                            setObjections([
                                "ยังไม่พร้อม ตอนนี้ยังไม่สนใจ",
                                "มีที่ปรึกษาอยู่แล้ว ขอบคุณ",
                                "ขอดูรายละเอียดเพิ่มเติมก่อน"
                            ]);
                        }
                    } catch (error) {
                        console.error('Error fetching objections:', error);
                        setObjections([
                            "ยังไม่พร้อม ตอนนี้ยังไม่สนใจ",
                            "มีที่ปรึกษาอยู่แล้ว ขอบคุณ",
                            "ขอดูรายละเอียดเพิ่มเติมก่อน"
                        ]);
                    }
                }
                
                setLoading(false);
                setView('scenario');
            };
            
            // Start roleplay
            const startRoleplay = () => {
                if (!currentScenario || objections.length === 0) return;
                
                const randomObjection = objections[Math.floor(Math.random() * objections.length)];
                setCurrentObjection(randomObjection);
                setRecordingState('idle');
                setTranscript('');
                setAudioBlob(null);
                setView('record');
            };
            
            // Recording functions
            const startRecording = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // Setup media recorder
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    audioChunksRef.current = [];
                    
                    mediaRecorderRef.current.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            audioChunksRef.current.push(event.data);
                        }
                    };
                    
                    mediaRecorderRef.current.onstop = () => {
                        const blob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                        setAudioBlob(blob);
                    };
                    
                    mediaRecorderRef.current.start(1000);
                    
                    // Setup speech recognition if available
                    if (isSTTSupported) {
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                        recognitionRef.current = new SpeechRecognition();
                        recognitionRef.current.continuous = true;
                        recognitionRef.current.interimResults = true;
                        recognitionRef.current.lang = 'th-TH';
                        
                        recognitionRef.current.onresult = (event) => {
                            let interimTranscript = '';
                            let finalTranscript = '';
                            
                            for (let i = event.resultIndex; i < event.results.length; ++i) {
                                if (event.results[i].isFinal) {
                                    finalTranscript += event.results[i][0].transcript;
                                } else {
                                    interimTranscript += event.results[i][0].transcript;
                                }
                            }
                            
                            setTranscript(prev => {
                                const newTranscript = prev + finalTranscript;
                                return newTranscript + (interimTranscript ? ' ' + interimTranscript : '');
                            });
                        };
                        
                        recognitionRef.current.onerror = (event) => {
                            console.error('Speech recognition error:', event.error);
                        };
                        
                        recognitionRef.current.start();
                    }
                    
                    setRecordingState('recording');
                    setTimer(0);
                    
                } catch (error) {
                    console.error('Error starting recording:', error);
                    alert('ไม่สามารถเข้าถึงไมโครโฟนได้ กรุณาตรวจสอบการอนุญาต');
                }
            };
            
            const stopRecording = () => {
                setRecordingState('preview');
                
                if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {
                    mediaRecorderRef.current.stop();
                    mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());
                }
                
                if (recognitionRef.current) {
                    recognitionRef.current.stop();
                }
            };
            
            // Timer effect
            React.useEffect(() => {
                if (recordingState === 'recording') {
                    timerRef.current = setInterval(() => {
                        setTimer(prev => prev + 1);
                    }, 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                
                return () => {
                    clearInterval(timerRef.current);
                };
            }, [recordingState]);
            
            // Play audio preview
            const playAudioPreview = () => {
                if (audioBlob && audioPreviewRef.current) {
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPreviewRef.current.src = audioUrl;
                    audioPreviewRef.current.play().catch(e => console.error('Error playing audio:', e));
                }
            };
            
            // Submit for AI evaluation
            const submitForEvaluation = async () => {
                setView('processing');
                
                // Get the appropriate prompt
                const currentPrompt = prompts[course] || prompts.mama1;
                const promptText = currentPrompt ? currentPrompt.prompt_text : '';
                
                // Prepare transcript
                const effectiveTranscript = transcript.trim().length > 5 ? transcript : "(ไม่มีข้อความที่แปลงจากเสียง)";
                
                // Prepare data for AI
                const evaluationData = {
                    situation: currentScenario?.situation || '',
                    problem: currentScenario?.problem || '',
                    impact: currentScenario?.impact || '',
                    need_payoff: currentScenario?.need_payoff || '',
                    financial_products: JSON.stringify(currentScenario?.financial_products || []),
                    objection: currentObjection,
                    transcript: effectiveTranscript,
                    course: course
                };
                
                let aiResult = null;
                
                // Try to use Gemini AI if key is available
                if (geminiKey && geminiKey !== 'YOUR_GEMINI_API_KEY_HERE') {
                    try {
                        // Construct the prompt
                        let fullPrompt = promptText;
                        Object.keys(evaluationData).forEach(key => {
                            fullPrompt = fullPrompt.replace(new RegExp(`{${key}}`, 'g'), evaluationData[key]);
                        });
                        
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${geminiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: fullPrompt
                                    }]
                                }]
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`API error: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text || '';
                        
                        // Try to parse JSON from response
                        const jsonMatch = aiText.match(/```json\n([\s\S]*?)\n```/) || aiText.match(/{[\s\S]*}/);
                        const jsonString = jsonMatch ? jsonMatch[0].replace(/```json\n|```/g, '') : aiText;
                        
                        try {
                            aiResult = JSON.parse(jsonString);
                        } catch (parseError) {
                            console.error('Error parsing AI response:', parseError);
                            // Create fallback result
                            aiResult = createFallbackResult(effectiveTranscript.length > 50);
                        }
                        
                    } catch (error) {
                        console.error('Error calling Gemini API:', error);
                        aiResult = createFallbackResult(effectiveTranscript.length > 50);
                    }
                } else {
                    // Use fallback result
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    aiResult = createFallbackResult(effectiveTranscript.length > 50);
                }
                
                // Save submission to Supabase
                try {
                    const { error: submitError } = await supabaseClient
                        .from('submissions')
                        .insert({
                            user_id: user.empId,
                            user_name: user.firstName + ' ' + (user.lastName || ''),
                            rh_code: user.rh_code,
                            zone_code: user.zone_code,
                            course: course,
                            scenario_id: currentScenario?.id,
                            transcript: effectiveTranscript,
                            spin_analysis: aiResult.spin_scores || {},
                            score: aiResult.total || 0,
                            feedback: aiResult.aiAdvise || '',
                            ai_analysis: aiResult
                        });
                    
                    if (submitError) {
                        console.error('Error saving submission:', submitError);
                    }
                } catch (error) {
                    console.error('Error saving to database:', error);
                }
                
                setResult(aiResult);
                setView('result');
            };
            
            // Helper function to create fallback result
            const createFallbackResult = (hasGoodTranscript) => {
                const baseScore = hasGoodTranscript ? Math.floor(Math.random() * 30) + 60 : Math.floor(Math.random() * 40) + 40;
                
                return {
                    total: baseScore,
                    isPassed: baseScore >= 70,
                    spin_scores: {
                        situation: [Math.min(25, Math.floor(baseScore / 4)), "เปิดบทสนทนาจากสถานการณ์ได้ดี"],
                        problem: [Math.min(25, Math.floor(baseScore / 4)), "ระบุปัญหาที่อาจเกิดขึ้นได้ชัดเจน"],
                        impact: [Math.min(25, Math.floor(baseScore / 4)), "สื่อสารผลกระทบได้อย่างมีประสิทธิภาพ"],
                        need: [Math.min(25, Math.floor(baseScore / 4)), "เสนอทางแก้ไขที่เหมาะสม"]
                    },
                    aiAdvise: hasGoodTranscript 
                        ? "คุณใช้ S-P-I-N Framework ได้ดี เปิดบทสนทนาได้เป็นธรรมชาติและระบุปัญหาชัดเจน เพียงแต่สามารถเพิ่มการสื่อสารผลกระทบให้ชัดเจนขึ้นอีกเล็กน้อย"
                        : "ควรฝึกฝนการเปิดบทสนทนาจากสถานการณ์ให้เป็นธรรมชาติมากขึ้น และฝึกการใช้คำถามเพื่อค้นหาปัญหาที่แท้จริงของลูกค้า",
                    suggested_improvements: [
                        "ฝึกใช้คำถามเปิดเพื่อสำรวจความต้องการ",
                        "เพิ่มการยกตัวอย่างเพื่อแสดงผลกระทบ",
                        "เสนอทางเลือกมากกว่า 1 ทางแก้ไข"
                    ]
                };
            };
            
            // Render based on current view
            const renderView = () => {
                switch (view) {
                    case 'passcode':
                        return React.createElement(PasscodeScreen, { onPasscodeCorrect: () => setView('login') });
                    
                    case 'login':
                        return React.createElement('div', {
                            className: "flex-1 p-8 flex flex-col justify-center bg-gradient-to-b from-white to-brand-50"
                        },
                        React.createElement('div', {
                            className: "text-center mb-10"
                        },
                        React.createElement('div', {
                            className: "w-24 h-24 spin-gradient rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg"
                        },
                        React.createElement('span', {
                            className: "text-white font-black text-2xl"
                        }, "SPIN")),
                        React.createElement('h1', {
                            className: "text-3xl font-black text-gradient-spin mb-2"
                        }, "MAMA Roleplay"),
                        React.createElement('p', {
                            className: "text-gray-600 text-sm mb-8"
                        }, "ระบบฝึกฝนทักษะการขายด้วย S-P-I-N Framework")),
                        
                        React.createElement('div', {
                            className: "space-y-4 mb-8"
                        },
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "รหัสพนักงาน"),
                            React.createElement('input', {
                                type: "text",
                                value: user.empId,
                                onChange: (e) => setUser({...user, empId: e.target.value}),
                                className: "w-full p-4 bg-gray-50 rounded-xl text-sm border border-gray-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 focus:outline-none transition",
                                placeholder: "เช่น B0001"
                            })),
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "ชื่อ"),
                            React.createElement('input', {
                                type: "text",
                                value: user.firstName,
                                onChange: (e) => setUser({...user, firstName: e.target.value}),
                                className: "w-full p-4 bg-gray-50 rounded-xl text-sm border border-gray-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 focus:outline-none transition",
                                placeholder: "ชื่อจริง"
                            })),
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: "block text-sm font-medium text-gray-700 mb-1"
                            }, "ตำแหน่ง"),
                            React.createElement('select', {
                                value: user.position,
                                onChange: (e) => setUser({...user, position: e.target.value}),
                                className: "w-full p-4 bg-gray-50 rounded-xl text-sm border border-gray-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-200 focus:outline-none transition"
                            },
                            React.createElement('option', { value: "Staff" }, "พนักงาน"),
                            React.createElement('option', { value: "Officer" }, "เจ้าหน้าที่"),
                            React.createElement('option', { value: "Manager" }, "ผู้จัดการ"),
                            React.createElement('option', { value: "Advisor" }, "ที่ปรึกษา")))),
                        
                        React.createElement('button', {
                            onClick: () => setView('rh_selection'),
                            className: "w-full spin-gradient text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center"
                        },
                        "ต่อไป",
                        React.createElement(Icons.ChevronRight, { className: "ml-2" })));
                    
                    case 'rh_selection':
                        const uniqueRHs = [...new Set(rhZones.map(zone => zone.rh_code))];
                        
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement('div', {
                            className: "bg-brand-900 text-white p-6 rounded-b-3xl"
                        },
                        React.createElement('h2', {
                            className: "text-xl font-black mb-2"
                        }, "เลือก Regional Head (RH)"),
                        React.createElement('p', {
                            className: "text-brand-200 text-sm"
                        }, "กรุณาเลือก RH ที่คุณสังกัด")),
                        
                        React.createElement('div', {
                            className: "flex-1 p-6 overflow-y-auto"
                        },
                        React.createElement('div', {
                            className: "space-y-3"
                        },
                        uniqueRHs.map(rhCode => {
                            const rhName = rhZones.find(z => z.rh_code === rhCode)?.rh_name || rhCode;
                            return React.createElement('button', {
                                key: rhCode,
                                onClick: () => handleRhSelect(rhCode),
                                className: `w-full p-5 text-left rounded-xl border-2 transition-all ${user.rh_code === rhCode ? 'border-brand-500 bg-brand-50' : 'border-gray-200 hover:border-brand-300'}`,
                                style: user.rh_code === rhCode ? { borderLeftWidth: '6px', borderLeftColor: '#0ea5e9' } : {}
                            },
                            React.createElement('div', {
                                className: "font-bold text-gray-800 text-lg mb-1"
                            }, rhName),
                            React.createElement('div', {
                                className: "text-sm text-gray-500"
                            }, "คลิกเพื่อเลือก"));
                        })),
                        
                        React.createElement('div', {
                            className: "p-4 border-t"
                        },
                        React.createElement('button', {
                            onClick: () => setView('login'),
                            className: "w-full py-3 text-gray-600 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors"
                        }, "กลับ")));
                    
                    case 'zone_selection':
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement('div', {
                            className: "bg-brand-900 text-white p-6 rounded-b-3xl"
                        },
                        React.createElement('h2', {
                            className: "text-xl font-black mb-2"
                        }, "เลือก Zone"),
                        React.createElement('p', {
                            className: "text-brand-200 text-sm"
                        }, `กรุณาเลือก Zone ใน ${user.rh_code}`)),
                        
                        React.createElement('div', {
                            className: "flex-1 p-6 overflow-y-auto"
                        },
                        zones.length > 0 ?
                            React.createElement('div', {
                                className: "space-y-3"
                            },
                            zones.map(zone => 
                                React.createElement('button', {
                                    key: zone.zone_code,
                                    onClick: () => handleZoneSelect(zone.zone_code, zone.zone_name),
                                    className: `w-full p-5 text-left rounded-xl border-2 transition-all ${user.zone_code === zone.zone_code ? 'border-brand-500 bg-brand-50' : 'border-gray-200 hover:border-brand-300'}`,
                                    style: user.zone_code === zone.zone_code ? { borderLeftWidth: '6px', borderLeftColor: '#0ea5e9' } : {}
                                },
                                React.createElement('div', {
                                    className: "font-bold text-gray-800 text-lg mb-1"
                                }, zone.zone_name),
                                React.createElement('div', {
                                    className: "text-sm text-gray-500"
                                }, `รหัส: ${zone.zone_code}`))) :
                            React.createElement('div', {
                                className: "text-center py-10"
                            },
                            React.createElement(Icons.AlertCircle, {
                                className: "text-gray-400 mx-auto mb-4",
                                size: 48
                            }),
                            React.createElement('p', {
                                className: "text-gray-500"
                            }, "กรุณาเลือก RH ก่อน"))),
                        
                        React.createElement('div', {
                            className: "p-4 border-t"
                        },
                        React.createElement('div', {
                            className: "flex space-x-3"
                        },
                        React.createElement('button', {
                            onClick: () => setView('rh_selection'),
                            className: "flex-1 py-3 text-gray-600 rounded-lg border border-gray-300 hover:bg-gray-50 transition-colors"
                        }, "กลับ"),
                        React.createElement('button', {
                            onClick: saveUserAndProceed,
                            disabled: !user.rh_code || !user.zone_code,
                            className: `flex-1 py-3 rounded-lg font-bold ${user.rh_code && user.zone_code ? 'spin-gradient text-white hover:shadow-xl' : 'bg-gray-300 text-gray-500'} transition-all`
                        }, "บันทึกและเริ่มต้นใช้งาน"))));
                    
                    case 'intro':
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement(Header, { user: user }),
                        
                        React.createElement('div', {
                            className: "flex-1 p-8 overflow-y-auto"
                        },
                        React.createElement('h2', {
                            className: "text-2xl font-black text-brand-900 mb-6"
                        }, "S-P-I-N Framework"),
                        React.createElement('p', {
                            className: "text-gray-600 mb-8"
                        }, "ระบบฝึกฝนทักษะการขายแบบเป็นธรรมชาติ"),
                        
                        React.createElement('div', {
                            className: "mb-10"
                        },
                        React.createElement('div', {
                            className: "grid grid-cols-2 gap-3 mb-6"
                        },
                        [
                            { letter: 'S', color: 'bg-blue-500', title: 'Situation', desc: 'เปิดบทสนทนาจากสถานการณ์' },
                            { letter: 'P', color: 'bg-red-500', title: 'Problem', desc: 'ระบุปัญหาที่อาจเกิดขึ้น' },
                            { letter: 'I', color: 'bg-amber-500', title: 'Impact', desc: 'สื่อสารผลกระทบของปัญหา' },
                            { letter: 'N', color: 'bg-emerald-500', title: 'Need', desc: 'เสนอทางแก้ไขที่เหมาะสม' }
                        ].map(item => 
                            React.createElement('div', {
                                key: item.letter,
                                className: "bg-white p-4 rounded-xl border border-gray-100 shadow-sm text-center"
                            },
                            React.createElement('div', {
                                className: `w-12 h-12 ${item.color} text-white rounded-full flex items-center justify-center text-xl font-black mx-auto mb-2`
                            }, item.letter),
                            React.createElement('h3', {
                                className: "font-bold text-gray-800 text-sm"
                            }, item.title),
                            React.createElement('p', {
                                className: "text-xs text-gray-500"
                            }, item.desc)))),
                        
                        React.createElement('div', {
                            className: "space-y-4 mb-8"
                        },
                        [
                            { num: 1, title: "เลือกหลักสูตร", desc: "MAMA1 (พื้นฐาน) หรือ MAMA2 (ขั้นสูง)" },
                            { num: 2, title: "ศึกษาโจทย์", desc: "ทำความเข้าใจสถานการณ์และลูกค้า" },
                            { num: 3, title: "บทบาทสมมติ", desc: "บันทึกเสียงตอบข้อโต้แย้งลูกค้า" },
                            { num: 4, title: "รับผลวิเคราะห์", desc: "ประเมินผลด้วย S-P-I-N Framework" }
                        ].map(step => 
                            React.createElement('div', {
                                key: step.num,
                                className: "flex items-center p-4 bg-white rounded-xl border border-gray-100 shadow-sm"
                            },
                            React.createElement('div', {
                                className: "w-10 h-10 bg-brand-100 text-brand-700 rounded-lg flex items-center justify-center font-bold text-sm mr-4"
                            }, step.num),
                            React.createElement('div', null,
                                React.createElement('h3', {
                                    className: "font-bold text-gray-800"
                                }, step.title),
                                React.createElement('p', {
                                    className: "text-sm text-gray-500"
                                }, step.desc))))),
                        
                        React.createElement('button', {
                            onClick: () => setView('menu'),
                            className: "w-full spin-gradient text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center"
                        },
                        "เริ่มการฝึกฝน",
                        React.createElement(Icons.Play, { className: "ml-2" }))));
                    
                    case 'menu':
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement(Header, { user: user }),
                        
                        React.createElement('div', {
                            className: "flex-1 p-6 overflow-y-auto"
                        },
                        React.createElement('h2', {
                            className: "text-gray-400 font-bold text-xs uppercase tracking-wider mb-4"
                        }, "เลือกหลักสูตร"),
                        
                        React.createElement('div', {
                            className: "space-y-4"
                        },
                        [
                            {
                                id: 'mama1',
                                title: 'MAMA1 (พื้นฐาน)',
                                desc: 'ฝึกการเปิดบทสนทนาจากสถานการณ์ในสาขา',
                                icon: Icons.Users,
                                color: 'bg-blue-50 text-blue-700',
                                borderColor: 'border-blue-200'
                            },
                            {
                                id: 'mama2',
                                title: 'MAMA2 (ขั้นสูง)',
                                desc: 'ฝึกการวิเคราะห์และเชื่อมโยงกับผลิตภัณฑ์ที่มี',
                                icon: Icons.Briefcase,
                                color: 'bg-purple-50 text-purple-700',
                                borderColor: 'border-purple-200'
                            }
                        ].map(courseItem => 
                            React.createElement('div', {
                                key: courseItem.id,
                                onClick: () => handleCourseSelect(courseItem.id),
                                className: `p-5 rounded-2xl border ${courseItem.borderColor} bg-white shadow-sm cursor-pointer hover:shadow-md transition-all active:scale-95 card-hover ${loading && course === courseItem.id ? 'opacity-70' : ''}`
                            },
                            React.createElement('div', { className: "flex items-center" },
                                React.createElement('div', {
                                    className: `w-14 h-14 rounded-xl flex items-center justify-center mr-4 ${courseItem.color}`
                                }, React.createElement(courseItem.icon, { size: 24 })),
                                React.createElement('div', { className: "flex-1" },
                                    React.createElement('h3', {
                                        className: "font-bold text-lg text-gray-800"
                                    }, courseItem.title),
                                    React.createElement('p', {
                                        className: "text-xs text-gray-500 mt-1"
                                    }, courseItem.desc))),
                            loading && course === courseItem.id ?
                                React.createElement('div', { className: "mt-4 flex justify-center" },
                                    React.createElement(Icons.Loader2, { className: "animate-spin text-brand-500" })) :
                                React.createElement('div', { className: "mt-4 flex justify-end" },
                                    React.createElement('span', {
                                        className: "text-xs font-bold text-brand-600 flex items-center"
                                    }, "คลิกเพื่อเริ่ม ", React.createElement(Icons.ArrowRight, { size: 14, className: "ml-1" })))))),
                        
                        React.createElement('div', {
                            className: "mt-8 pt-6 border-t"
                        },
                        React.createElement('div', {
                            className: "text-center"
                        },
                        React.createElement('button', {
                            onClick: () => {
                                localStorage.removeItem('mama_user');
                                localStorage.removeItem('mama_passcode_verified');
                                setView('passcode');
                            },
                            className: "text-sm text-gray-500 hover:text-red-600 flex items-center justify-center mx-auto"
                        },
                        React.createElement(Icons.LogOut, { size: 16, className: "mr-2" }),
                        "ออกจากระบบ")))),
                    
                    case 'scenario':
                        if (!currentScenario) {
                            return React.createElement('div', {
                                className: "flex-1 flex flex-col items-center justify-center p-8"
                            },
                            React.createElement(Icons.AlertCircle, { className: "text-gray-400 mb-4", size: 48 }),
                            React.createElement('button', {
                                onClick: () => setView('menu'),
                                className: "mt-4 px-6 py-2 bg-brand-500 text-white rounded-lg"
                            }, "กลับสู่เมนูหลัก"));
                        }
                        
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement(Header, { 
                            title: "ภารกิจฝึกฝน", 
                            user: user,
                            onBack: () => setView('menu'),
                            showBack: true
                        }),
                        
                        React.createElement('div', {
                            className: "flex-1 overflow-y-auto p-6 pb-24"
                        },
                        React.createElement('div', { className: "space-y-6" },
                            // Scenario Title
                            React.createElement('div', {
                                className: "spin-badge bg-white p-5 rounded-2xl border border-gray-100 shadow-sm"
                            },
                            React.createElement('h2', {
                                className: "text-xl font-black text-gray-800 mb-2"
                            }, currentScenario.title),
                            React.createElement('div', {
                                className: "flex items-center text-sm text-gray-500"
                            },
                            React.createElement(Icons.Clock, { size: 16, className: "mr-1" }),
                            currentScenario.time_limit || '5 นาที')),
                            
                            // S-P-I-N Framework Sections
                            React.createElement('div', { className: "space-y-4" },
                                // Situation
                                React.createElement('div', {
                                    className: "bg-blue-50 border border-blue-100 rounded-xl p-5"
                                },
                                React.createElement('div', {
                                    className: "flex items-center mb-3"
                                },
                                React.createElement('div', {
                                    className: "w-8 h-8 bg-blue-500 text-white rounded-lg flex items-center justify-center font-bold mr-3"
                                }, "S"),
                                React.createElement('h3', {
                                    className: "font-bold text-blue-900"
                                }, "สถานการณ์ (Situation)")),
                                React.createElement('p', {
                                    className: "text-gray-700 leading-relaxed"
                                }, currentScenario.situation)),
                                
                                // Problem
                                React.createElement('div', {
                                    className: "bg-red-50 border border-red-100 rounded-xl p-5"
                                },
                                React.createElement('div', {
                                    className: "flex items-center mb-3"
                                },
                                React.createElement('div', {
                                    className: "w-8 h-8 bg-red-500 text-white rounded-lg flex items-center justify-center font-bold mr-3"
                                }, "P"),
                                React.createElement('h3', {
                                    className: "font-bold text-red-900"
                                }, "ปัญหา (Problem)")),
                                React.createElement('p', {
                                    className: "text-gray-700 leading-relaxed"
                                }, currentScenario.problem)),
                                
                                // Impact
                                React.createElement('div', {
                                    className: "bg-amber-50 border border-amber-100 rounded-xl p-5"
                                },
                                React.createElement('div', {
                                    className: "flex items-center mb-3"
                                },
                                React.createElement('div', {
                                    className: "w-8 h-8 bg-amber-500 text-white rounded-lg flex items-center justify-center font-bold mr-3"
                                }, "I"),
                                React.createElement('h3', {
                                    className: "font-bold text-amber-900"
                                }, "ผลกระทบ (Impact)")),
                                React.createElement('p', {
                                    className: "text-gray-700 leading-relaxed"
                                }, currentScenario.impact)),
                                
                                // Need Payoff
                                React.createElement('div', {
                                    className: "bg-emerald-50 border border-emerald-100 rounded-xl p-5"
                                },
                                React.createElement('div', {
                                    className: "flex items-center mb-3"
                                },
                                React.createElement('div', {
                                    className: "w-8 h-8 bg-emerald-500 text-white rounded-lg flex items-center justify-center font-bold mr-3"
                                }, "N"),
                                React.createElement('h3', {
                                    className: "font-bold text-emerald-900"
                                }, "ทางแก้ไข (Need Payoff)")),
                                React.createElement('p', {
                                    className: "text-gray-700 leading-relaxed"
                                }, currentScenario.need_payoff))),
                            
                            // Customer Profile
                            React.createElement('div', {
                                className: "bg-white p-5 rounded-2xl border border-gray-100 shadow-sm"
                            },
                            React.createElement('div', {
                                className: "flex items-center mb-3"
                            },
                            React.createElement(Icons.User, { className: "text-gray-600 mr-2", size: 20 }),
                            React.createElement('h3', {
                                className: "font-bold text-gray-800"
                            }, "ข้อมูลลูกค้า")),
                            
                            currentScenario.customer_profile && typeof currentScenario.customer_profile === 'object' ?
                                React.createElement('div', {
                                    className: "grid grid-cols-2 gap-3"
                                },
                                Object.entries(currentScenario.customer_profile).map(([key, value]) => 
                                    React.createElement('div', {
                                        key: key,
                                        className: "bg-gray-50 p-3 rounded-lg"
                                    },
                                    React.createElement('div', {
                                        className: "text-xs text-gray-500 uppercase font-medium mb-1"
                                    }, key),
                                    React.createElement('div', {
                                        className: "font-medium text-gray-800"
                                    }, value)))) :
                                React.createElement('div', { className: "text-gray-500" }, "ไม่มีข้อมูลลูกค้า"),
                            
                            // Financial Products
                            currentScenario.financial_products && currentScenario.financial_products.length > 0 &&
                            React.createElement('div', {
                                className: "bg-white p-5 rounded-2xl border border-gray-100 shadow-sm"
                            },
                            React.createElement('div', {
                                className: "flex items-center mb-3"
                            },
                            React.createElement(Icons.CreditCard, { className: "text-gray-600 mr-2", size: 20 }),
                            React.createElement('h3', {
                                className: "font-bold text-gray-800"
                            }, "ผลิตภัณฑ์ที่ลูกค้ามี")),
                            React.createElement('div', {
                                className: "flex flex-wrap gap-2"
                            },
                            Array.isArray(currentScenario.financial_products) ?
                                currentScenario.financial_products.map((product, index) => 
                                    React.createElement('span', {
                                        key: index,
                                        className: "bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full"
                                    }, product)) :
                                React.createElement('span', {
                                    className: "bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full"
                                }, currentScenario.financial_products))),
                            
                            // Objectives
                            React.createElement('div', {
                                className: "bg-white p-5 rounded-2xl border border-gray-100 shadow-sm"
                            },
                            React.createElement('div', {
                                className: "flex items-center mb-3"
                            },
                            React.createElement(Icons.Target, { className: "text-gray-600 mr-2", size: 20 }),
                            React.createElement('h3', {
                                className: "font-bold text-gray-800"
                            }, "เป้าหมายในการฝึก")),
                            React.createElement('ul', { className: "space-y-2" },
                                (currentScenario.objectives || []).map((obj, index) =>
                                    React.createElement('li', {
                                        key: index,
                                        className: "flex items-start"
                                    },
                                    React.createElement(Icons.CheckCircle, {
                                        className: "text-green-500 mr-2 mt-0.5 flex-shrink-0",
                                        size: 16
                                    }),
                                    React.createElement('span', {
                                        className: "text-gray-700"
                                    }, obj)))))),
                        
                        // Start button
                        React.createElement('div', {
                            className: "p-4 bg-white/90 backdrop-blur border-t fixed bottom-0 w-full max-w-md"
                        },
                        React.createElement('button', {
                            onClick: startRoleplay,
                            className: "w-full spin-gradient text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center"
                        },
                        "เริ่มบทบาทสมมติ",
                        React.createElement(Icons.Mic, { className: "ml-2" }))));
                    
                    case 'record':
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col bg-gradient-to-b from-brand-900 to-brand-800 text-white"
                        },
                        React.createElement(Header, { 
                            title: "บันทึกเสียง", 
                            user: user,
                            onBack: () => setView('scenario'),
                            showBack: true
                        }),
                        
                        React.createElement('div', {
                            className: "flex-1 p-6 flex flex-col"
                        },
                        // Objection display
                        React.createElement('div', {
                            className: "glass-effect p-5 rounded-2xl mb-6"
                        },
                        React.createElement('div', {
                            className: "flex items-center text-sm font-bold mb-3"
                        },
                        React.createElement(Icons.AlertCircle, { size: 16, className: "mr-2" }),
                        "ข้อโต้แย้งจากลูกค้า"),
                        React.createElement('p', {
                            className: "text-xl font-bold italic leading-relaxed text-center"
                        }, `"${currentObjection}"`),
                        React.createElement('div', {
                            className: "text-center mt-3 text-brand-200 text-sm"
                        },
                        React.createElement(Icons.Info, { size: 14, className: "inline mr-1" }),
                        "ใช้ S-P-I-N Framework ตอบคำถามนี้")),
                        
                        // Timer and visualizer
                        React.createElement('div', {
                            className: "text-center mb-6"
                        },
                        React.createElement('div', {
                            className: "text-6xl font-mono font-light mb-4"
                        },
                        Math.floor(timer / 60).toString().padStart(2, '0'),
                        ":",
                        (timer % 60).toString().padStart(2, '0')),
                        
                        recordingState === 'recording' && React.createElement(AudioVisualizer, { isRecording: true })),
                        
                        // Transcript preview
                        transcript && React.createElement('div', {
                            className: "glass-effect p-4 rounded-xl mb-6"
                        },
                        React.createElement('div', {
                            className: "text-xs font-bold text-brand-200 mb-2 flex items-center"
                        },
                        React.createElement(Icons.MessageSquare, { size: 14, className: "mr-1" }),
                        "ข้อความที่ได้จากเสียง:"),
                        React.createElement('p', {
                            className: "text-sm text-white"
                        }, transcript)),
                        
                        // Recording controls
                        React.createElement('div', {
                            className: "mt-auto"
                        },
                        recordingState === 'idle' ?
                            React.createElement('div', { className: "text-center" },
                                React.createElement('button', {
                                    onClick: startRecording,
                                    className: "w-24 h-24 bg-white text-brand-900 rounded-full flex items-center justify-center mx-auto shadow-xl hover:scale-105 transition-all"
                                },
                                React.createElement(Icons.Mic, { size: 32 })),
                                React.createElement('p', {
                                    className: "text-brand-200 mt-4 text-sm"
                                }, "กดเพื่อเริ่มบันทึกเสียง")) :
                            
                            recordingState === 'recording' ?
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('button', {
                                        onClick: stopRecording,
                                        className: "w-24 h-24 bg-red-500 text-white rounded-full flex items-center justify-center mx-auto recording-pulse"
                                    },
                                    React.createElement(Icons.Square, { size: 24, fill: "currentColor" })),
                                    React.createElement('p', {
                                        className: "text-red-300 mt-4 text-sm font-bold"
                                    }, "กำลังบันทึก... กดหยุด")) :
                            
                            // Preview state
                            React.createElement('div', { className: "space-y-4 animate-slide-in" },
                                React.createElement('div', { className: "flex gap-3" },
                                    React.createElement('button', {
                                        onClick: playAudioPreview,
                                        className: "flex-1 glass-effect py-4 rounded-xl font-bold text-sm flex justify-center items-center hover:bg-white/20 transition-colors"
                                    },
                                    React.createElement(Icons.Volume2, { className: "mr-2", size: 18 }),
                                    "ฟังเสียง"),
                                    React.createElement('button', {
                                        onClick: () => {
                                            setRecordingState('idle');
                                            setTranscript('');
                                            setAudioBlob(null);
                                        },
                                        className: "flex-1 glass-effect py-4 rounded-xl font-bold text-sm flex justify-center items-center hover:bg-white/20 transition-colors"
                                    },
                                    React.createElement(Icons.RefreshCw, { className: "mr-2", size: 18 }),
                                    "บันทึกใหม่")),
                                React.createElement('button', {
                                    onClick: submitForEvaluation,
                                    className: "w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center"
                                },
                                "ส่งให้ AI ประเมินผล",
                                React.createElement(Icons.Send, { className: "ml-2" })))),
                        
                        // Hidden audio element for preview
                        React.createElement('audio', {
                            ref: audioPreviewRef,
                            className: "hidden"
                        })));
                    
                    case 'processing':
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col items-center justify-center bg-gradient-to-b from-white to-brand-50 p-8"
                        },
                        React.createElement('div', { className: "relative mb-8" },
                            React.createElement('div', {
                                className: "w-24 h-24 border-4 border-brand-100 border-t-brand-600 rounded-full animate-spin"
                            }),
                            React.createElement('div', {
                                className: "absolute inset-0 flex items-center justify-center"
                            },
                            React.createElement('div', {
                                className: "w-16 h-16 spin-gradient rounded-full flex items-center justify-center"
                            },
                            React.createElement('span', {
                                className: "text-white font-black text-xl"
                            }, "SPIN")))),
                        
                        React.createElement('h2', {
                            className: "text-2xl font-black text-gradient-spin mb-2"
                        }, "AI กำลังวิเคราะห์..."),
                        React.createElement('p', {
                            className: "text-gray-600 text-center max-w-xs mb-6"
                        }, "ระบบกำลังประเมินการใช้งาน S-P-I-N Framework ของคุณ"),
                        
                        React.createElement('div', {
                            className: "flex space-x-1"
                        },
                        [...Array(4)].map((_, i) => 
                            React.createElement('div', {
                                key: i,
                                className: "w-2 h-2 rounded-full",
                                style: { 
                                    backgroundColor: i === 0 ? '#3b82f6' : i === 1 ? '#ef4444' : i === 2 ? '#f59e0b' : '#10b981',
                                    animation: `pulse 1.5s ease-in-out ${i * 0.2}s infinite`
                                }
                            }))));
                    
                    case 'result':
                        if (!result) {
                            return React.createElement('div', {
                                className: "flex-1 flex flex-col items-center justify-center p-8"
                            },
                            React.createElement(Icons.AlertCircle, { className: "text-gray-400 mb-4", size: 48 }),
                            React.createElement('button', {
                                onClick: () => setView('menu'),
                                className: "mt-4 px-6 py-2 bg-brand-500 text-white rounded-lg"
                            }, "กลับสู่เมนูหลัก"));
                        }
                        
                        return React.createElement('div', {
                            className: "flex-1 flex flex-col"
                        },
                        React.createElement(Header, {
                            title: "ผลการประเมิน",
                            user: user,
                            onBack: () => setView('menu'),
                            showBack: true
                        }),
                        
                        React.createElement('div', {
                            className: "flex-1 overflow-y-auto p-6 pb-24"
                        },
                        React.createElement('div', { className: "space-y-6" },
                            // Overall score
                            React.createElement('div', {
                                className: "spin-gradient text-white p-8 rounded-3xl text-center relative overflow-hidden"
                            },
                            React.createElement('div', {
                                className: "text-6xl font-black mb-2"
                            }, result.total || 0),
                            React.createElement('div', {
                                className: "text-sm font-bold opacity-90 mb-4"
                            }, "คะแนนรวม (เต็ม 100)"),
                            React.createElement('div', {
                                className: `inline-block px-6 py-2 rounded-full text-sm font-bold ${result.isPassed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`
                            },
                            result.isPassed ? "ผ่านเกณฑ์ ✓" : "ต้องปรับปรุง ✗")),
                            
                            // S-P-I-N Scores
                            React.createElement('div', null,
                                React.createElement('h3', {
                                    className: "font-bold text-gray-800 mb-4 text-lg"
                                }, "คะแนน S-P-I-N Framework"),
                                React.createElement('div', {
                                    className: "grid grid-cols-2 gap-3"
                                },
                                result.spin_scores ?
                                    Object.entries(result.spin_scores).map(([key, value]) => {
                                        const score = Array.isArray(value) ? value[0] : value;
                                        const feedback = Array.isArray(value) ? value[1] : '';
                                        return React.createElement('div', {
                                            key: key,
                                            className: "col-span-1"
                                        },
                                        React.createElement(SpinBadge, {
                                            type: key,
                                            score: score,
                                            max: 25
                                        }),
                                        feedback && React.createElement('p', {
                                            className: "text-xs text-gray-500 mt-2 text-center"
                                        }, feedback));
                                    }) :
                                    React.createElement('div', { className: "col-span-2 text-center text-gray-500" }, "ไม่มีข้อมูล"))),
                            
                            // AI Feedback
                            React.createElement('div', {
                                className: "bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-2xl border border-blue-100"
                            },
                            React.createElement('div', {
                                className: "flex items-center mb-3"
                            },
                            React.createElement(Icons.Headphones, { className: "text-blue-600 mr-2", size: 20 }),
                            React.createElement('h3', {
                                className: "font-bold text-blue-900"
                            }, "คำแนะนำจาก AI")),
                            React.createElement('p', {
                                className: "text-gray-700 leading-relaxed"
                            }, result.aiAdvise || "ไม่มีคำแนะนำ")),
                            
                            // Suggested Improvements
                            result.suggested_improvements && result.suggested_improvements.length > 0 &&
                            React.createElement('div', {
                                className: "bg-gradient-to-r from-amber-50 to-orange-50 p-6 rounded-2xl border border-amber-100"
                            },
                            React.createElement('div', {
                                className: "flex items-center mb-3"
                            },
                            React.createElement(Icons.Zap, { className: "text-amber-600 mr-2", size: 20 }),
                            React.createElement('h3', {
                                className: "font-bold text-amber-900"
                            }, "ข้อแนะนำสำหรับการพัฒนา")),
                            React.createElement('ul', { className: "space-y-2" },
                                result.suggested_improvements.map((improvement, index) =>
                                    React.createElement('li', {
                                        key: index,
                                        className: "flex items-start"
                                    },
                                    React.createElement(Icons.CheckCircle, {
                                        className: "text-green-500 mr-2 mt-0.5 flex-shrink-0",
                                        size: 16
                                    }),
                                    React.createElement('span', {
                                        className: "text-gray-700"
                                    }, improvement))))),
                            
                            // Actions
                            React.createElement('div', { className: "space-y-3" },
                                React.createElement('button', {
                                    onClick: () => {
                                        const courseScenarios = scenarios[course] || [];
                                        if (courseScenarios.length > 0) {
                                            const randomIndex = Math.floor(Math.random() * courseScenarios.length);
                                            setCurrentScenario(courseScenarios[randomIndex]);
                                            setView('scenario');
                                        } else {
                                            setView('menu');
                                        }
                                    },
                                    className: "w-full bg-brand-500 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-brand-600 active:scale-95 transition-all flex items-center justify-center"
                                },
                                React.createElement(Icons.RefreshCw, { className: "mr-2", size: 18 }),
                                "ฝึกอีกครั้ง"),
                                
                                React.createElement('button', {
                                    onClick: () => setView('menu'),
                                    className: "w-full bg-gray-800 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-900 active:scale-95 transition-all flex items-center justify-center"
                                },
                                React.createElement(Icons.LogOut, { className: "mr-2", size: 18 }),
                                "กลับสู่เมนูหลัก")))),
                        
                        // Admin button
                        React.createElement('div', {
                            className: "absolute bottom-4 right-4"
                        },
                        React.createElement('button', {
                            onClick: () => setShowAdmin(true),
                            className: "p-2 bg-gray-800 text-white rounded-full hover:bg-gray-900"
                        },
                        React.createElement(Icons.Settings, { size: 20 }))));
                    
                    default:
                        return React.createElement('div', {
                            className: "flex-1 flex items-center justify-center"
                        },
                        React.createElement('p', null, "เกิดข้อผิดพลาด"));
                }
            };
            
            // Determine which view to show based on user data
            React.useEffect(() => {
                if (view === 'login' && user.empId && user.firstName) {
                    if (!user.rh_code || !user.zone_code) {
                        setView('rh_selection');
                    }
                }
            }, [view, user]);
            
            // Main render
            return React.createElement('div', { className: "h-full w-full" },
                showAdmin && React.createElement(AdminPanel),
                renderView());
        };
        
        // Admin Panel Component
        const AdminPanel = () => {
            const [activeTab, setActiveTab] = React.useState('scenarios');
            const [newGeminiKey, setNewGeminiKey] = React.useState('');
            const [message, setMessage] = React.useState('');
            const [saving, setSaving] = React.useState(false);
            
            React.useEffect(() => {
                const savedKey = localStorage.getItem('mama_gemini_key');
                if (savedKey) {
                    setNewGeminiKey(savedKey);
                }
            }, []);
            
            const saveGeminiKey = async () => {
                setSaving(true);
                try {
                    localStorage.setItem('mama_gemini_key', newGeminiKey);
                    setMessage('บันทึก API Key สำเร็จ!');
                    
                    // Save to Supabase config table
                    const { error } = await supabaseClient
                        .from('config')
                        .upsert({
                            key_name: 'gemini_api_key',
                            key_value: newGeminiKey,
                            description: 'API Key สำหรับ Gemini AI'
                        }, {
                            onConflict: 'key_name'
                        });
                    
                    if (error) throw error;
                    
                } catch (error) {
                    console.error('Error saving Gemini key:', error);
                    setMessage('เกิดข้อผิดพลาดในการบันทึก');
                } finally {
                    setSaving(false);
                    setTimeout(() => setMessage(''), 3000);
                }
            };
            
            return React.createElement('div', {
                className: "fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50"
            },
            React.createElement('div', {
                className: "bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col"
            },
            // Header
            React.createElement('div', {
                className: "bg-brand-900 text-white p-6"
            },
            React.createElement('div', { className: "flex justify-between items-center mb-2" },
                React.createElement('h2', {
                    className: "text-xl font-black"
                }, "ระบบจัดการ (Admin Panel)"),
                React.createElement('button', {
                    onClick: () => setShowAdmin(false),
                    className: "p-1 hover:bg-white/10 rounded-lg"
                }, React.createElement(Icons.X, { size: 24 }))),
            React.createElement('p', { className: "text-brand-200 text-sm" }, "จัดการข้อมูลระบบ MAMA Roleplay")),
            
            // Tabs
            React.createElement('div', {
                className: "flex border-b"
            },
            ['settings'].map(tab => 
                React.createElement('button', {
                    key: tab,
                    onClick: () => setActiveTab(tab),
                    className: `flex-1 py-3 text-sm font-medium ${activeTab === tab ? 'text-brand-600 border-b-2 border-brand-600' : 'text-gray-500'}`
                },
                tab === 'settings' ? 'ตั้งค่า API' : tab))),
            
            // Content
            React.createElement('div', {
                className: "flex-1 overflow-y-auto p-6"
            },
            message && React.createElement('div', {
                className: `mb-4 p-3 rounded-lg text-sm ${message.includes('สำเร็จ') ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`
            }, message),
            
            activeTab === 'settings' ?
                React.createElement('div', { className: "space-y-6" },
                    React.createElement('div', null,
                        React.createElement('h3', { className: "font-bold text-gray-800 mb-4" }, "ตั้งค่า Gemini API"),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-1" }, "Gemini API Key"),
                                React.createElement('input', {
                                    type: "password",
                                    value: newGeminiKey,
                                    onChange: (e) => setNewGeminiKey(e.target.value),
                                    className: "w-full p-3 border border-gray-300 rounded-lg",
                                    placeholder: "ป้อน Gemini API Key"
                                })),
                            React.createElement('p', { className: "text-sm text-gray-500" },
                                "ดึง API Key ได้จาก ",
                                React.createElement('a', {
                                    href: "https://aistudio.google.com/app/apikey",
                                    target: "_blank",
                                    className: "text-brand-600 hover:underline"
                                }, "Google AI Studio")),
                            React.createElement('button', {
                                onClick: saveGeminiKey,
                                disabled: saving,
                                className: "w-full bg-gray-800 text-white py-3 rounded-lg font-bold hover:bg-gray-900 disabled:opacity-50 flex items-center justify-center"
                            },
                            saving ? React.createElement(Icons.Loader2, { className: "animate-spin mr-2" }) : null,
                            saving ? "กำลังบันทึก..." : "บันทึก API Key"))),
                    
                    React.createElement('div', null,
                        React.createElement('h3', { className: "font-bold text-gray-800 mb-4" }, "ข้อมูลระบบ"),
                        React.createElement('div', { className: "bg-gray-50 p-4 rounded-lg" },
                            React.createElement('div', { className: "space-y-2 text-sm" },
                                React.createElement('div', { className: "flex" },
                                    React.createElement('span', { className: "font-medium text-gray-600 w-32" }, "เวอร์ชัน:"),
                                    React.createElement('span', { className: "text-gray-800" }, "3.0 (S-P-I-N Framework)")),
                                React.createElement('div', { className: "flex" },
                                    React.createElement('span', { className: "font-medium text-gray-600 w-32" }, "สถานการณ์ MAMA1:"),
                                    React.createElement('span', { className: "text-gray-800" }, "10 รายการ")),
                                React.createElement('div', { className: "flex" },
                                    React.createElement('span', { className: "font-medium text-gray-600 w-32" }, "สถานการณ์ MAMA2:"),
                                    React.createElement('span', { className: "text-gray-800" }, "10 รายการ")),
                                React.createElement('div', { className: "flex" },
                                    React.createElement('span', { className: "font-medium text-gray-600 w-32" }, "S-P-I-N Framework:"),
                                    React.createElement('span', { className: "text-gray-800" }, "เปิดใช้งาน")))))) :
                null));
        };
        
        // Render the app
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(React.createElement(App));
    </script>
</body>
</html>
